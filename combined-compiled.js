var wpd=wpd||{};
wpd.initApp=function(c,a,b,d){wpd.isWindowed=c;wpd.image_ref=null==a?"start.png":a;wpd.initial_graph_json=b;wpd.parent_ref=d?d:document;$("link[href='/viewer/WPD/css/styles.css']").length?wpd.initDisplay():(wpd.css_loaded=[],wpd.css_loaded["/viewer/WPD/css/styles.css"]=!1,wpd.css_loaded["/viewer/WPD/css/widgets.css"]=!1,wpd.includeCss("/viewer/WPD/css/styles.css"),wpd.includeCss("/viewer/WPD/css/widgets.css"));window.addEventListener("message",$.proxy(wpd.iframe_api.receiveMessage,wpd.iframe_api));
window.addEventListener("dataChange",$.proxy(wpd.iframe_api.sendDataChangeUpdate,wpd.iframe_api))};wpd.initIfAllCSSLoaded=function(){wpd.css_loaded["/viewer/WPD/css/styles.css"]&&wpd.css_loaded["/viewer/WPD/css/widgets.css"]&&wpd.initDisplay()};wpd.initDisplay=function(){wpd.browserInfo.checkBrowser();wpd.layoutManager.initialLayout();var c=this.findElement("loadingCurtain");c&&(c.style.display="none");wpd.loadRemoteData()||wpd.saveResume.importImageAndJSON(wpd.image_ref,wpd.initial_graph_json)};
wpd.includeCss=function(c){var a=document.getElementsByTagName("head")[0],b=document.createElement("link");b.rel="stylesheet";b.type="text/css";b.href=c;b.media="all";b.onload=function(){wpd.css_loaded[c]=!0;wpd.initIfAllCSSLoaded()};a.appendChild(b)};
wpd.loadRemoteData=function(){return"undefined"===typeof wpdremote?!1:null!=wpdremote.status&&"fail"===wpdremote.status?(wpd.messagePopup.show("Remote Upload Failed!","Remote Upload Failed!"),!1):"success"===wpdremote.status&&null!=wpdremote.localUrl?(wpd.graphicsWidget.loadImageFromURL(wpdremote.localUrl),wpd.popup.show("axesList"),!0):!1};wpd.findElement=function(c){return this.parent_ref?wpd.parent_ref.find("#"+c)[0]:document.getElementById(c)};
wpd.findElementsByClass=function(c){return this.parent_ref?wpd.parent_ref.find("."+c):document.getElementsByClassName(c)};document.addEventListener("DOMContentLoaded",wpd.initApp,!0);wpd=wpd||{};wpd.appData=function(){function c(){null==b&&(b=new wpd.PlotData);return b}var a=!1,b;return{isAligned:function(b){null!=b&&(a=b);return a},getPlotData:c,reset:function(){a=!1;b=null},plotLoaded:function(a){c().topColors=wpd.colorAnalyzer.getTopColors(a)}}}();wpd=wpd||{};
wpd.AutoDetector=function(){return function(){this.fgColor=[0,0,200];this.bgColor=[255,255,255];this.mask=null;this.gridMask={xmin:null,xmax:null,ymin:null,ymax:null,pixels:[]};this.gridLineColor=[255,255,255];this.gridColorDistance=10;this.gridData=null;this.colorDetectionMode="fg";this.colorDistance=120;this.imageData=this.gridBinaryData=this.binaryData=this.algorithm=null;this.imageHeight=this.imageWidth=0;this.gridBackgroundMode=!0;this.reset=function(){this.gridData=this.imageData=this.binaryData=
this.mask=null;this.gridMask={xmin:null,xmax:null,ymin:null,ymax:null,pixels:[]}};this.generateBinaryDataFromMask=function(){var c,a,b,d,e,f,g="fg"===this.colorDetectionMode?this.fgColor:this.bgColor;for(c=0;c<this.mask.length;c++)a=this.mask[c],b=this.imageData.data[4*a],d=this.imageData.data[4*a+1],e=this.imageData.data[4*a+2],f=this.imageData.data[4*a+3],0===f&&(e=d=b=255),b=wpd.dist3d(b,d,e,g[0],g[1],g[2]),"fg"===this.colorDetectionMode?b<=this.colorDistance&&(this.binaryData[a]=!0):b>=this.colorDistance&&
(this.binaryData[a]=!0)};this.generateBinaryDataUsingFullImage=function(){var c,a,b="fg"===this.colorDetectionMode?this.fgColor:this.bgColor,d,e,f;for(a=0;a<this.imageData.data.length/4;a++)c=this.imageData.data[4*a],d=this.imageData.data[4*a+1],e=this.imageData.data[4*a+2],f=this.imageData.data[4*a+3],0===f&&(e=d=c=255),c=wpd.dist3d(c,d,e,b[0],b[1],b[2]),"fg"===this.colorDetectionMode?c<=this.colorDistance&&(this.binaryData[a]=!0):c>=this.colorDistance&&(this.binaryData[a]=!0)};this.generateBinaryData=
function(){this.binaryData=[];null==this.imageData?this.imageWidth=this.imageHeight=0:(this.imageHeight=this.imageData.height,this.imageWidth=this.imageData.width,null==this.mask||0===this.mask.length?this.generateBinaryDataUsingFullImage():this.generateBinaryDataFromMask())};this.generateGridBinaryData=function(){this.gridBinaryData=[];if(null==this.imageData)this.imageHeight=this.imageWidth=0;else{this.imageWidth=this.imageData.width;this.imageHeight=this.imageData.height;var c,a,b,d,e,f,g,h;if(null==
this.gridMask.pixels||0===this.gridMask.pixels.length){e=0;this.gridMask.pixels=[];for(a=0;a<this.imageHeight;a++)for(c=0;c<this.imageWidth;c++)d=a*this.imageWidth+c,b=this.imageData.data[4*d],f=this.imageData.data[4*d+1],g=this.imageData.data[4*d+2],h=this.imageData.data[4*d+3],0===h&&(g=f=b=255),b=wpd.dist3d(this.gridLineColor[0],this.gridLineColor[1],this.gridLineColor[2],b,f,g),this.gridBackgroundMode?b>this.gridColorDistance&&(this.gridBinaryData[d]=!0,this.gridMask.pixels[e]=d,e++):b<this.gridColorDistance&&
(this.gridBinaryData[d]=!0,this.gridMask.pixels[e]=d,e++);this.gridMask.xmin=0;this.gridMask.xmax=this.imageWidth;this.gridMask.ymin=0;this.gridMask.ymax=this.imageHeight}else for(e=0;e<this.gridMask.pixels.length;e++)d=this.gridMask.pixels[e],b=this.imageData.data[4*d],f=this.imageData.data[4*d+1],g=this.imageData.data[4*d+2],b=wpd.dist3d(this.gridLineColor[0],this.gridLineColor[1],this.gridLineColor[2],b,f,g),this.gridBackgroundMode?b>this.gridColorDistance&&(this.gridBinaryData[d]=!0):b<this.gridColorDistance&&
(this.gridBinaryData[d]=!0)}}}}();wpd=wpd||{};
wpd.Calibration=function(){return function(c){var a=[],b=[],d=null==c?2:c,e=[],f=[];this.labels=[];this.getCount=function(){return a.length};this.getDimensions=function(){return d};this.addPoint=function(c,f,k,m,l){var n=a.length,p=e.length;a[n]=c;b[n]=f;e[p]=k;e[p+1]=m;3===d&&(e[p+2]=l)};this.getPoint=function(c){return 0>c||c>=a.length?null:{px:a[c],py:b[c],dx:e[d*c],dy:e[d*c+1],dz:2===d?null:e[d*c+2]}};this.changePointPx=function(d,c,e){0>d||d>=a.length||(a[d]=c,b[d]=e)};this.setDataAt=function(b,
c,f,m){0>b||b>=a.length||(e[d*b]=c,e[d*b+1]=f,3===d&&(e[d*b+2]=m))};this.findNearestPoint=function(d,c,e){e=null==e?50:parseFloat(e);var f,l=-1,n,p;for(n=0;n<a.length;n++)if(p=Math.sqrt((d-a[n])*(d-a[n])+(c-b[n])*(c-b[n])),0>l&&p<=e||0<=l&&p<f)l=n,f=p;return l};this.selectPoint=function(a){0>f.indexOf(a)&&(f[f.length]=a)};this.selectNearestPoint=function(a,b,d){a=this.findNearestPoint(a,b,d);0<=a&&this.selectPoint(a)};this.getSelectedPoints=function(){return f};this.unselectAll=function(){f=[]};this.isPointSelected=
function(a){return 0<=f.indexOf(a)};this.dump=function(){console.log(a);console.log(b);console.log(e)}}}();wpd=wpd||{};wpd.ColorGroup=function(){return function(c){var a=0,b={r:0,g:0,b:0};c=null==c?100:c;this.getPixelCount=function(){return a};this.getAverageColor=function(){return b};this.isColorInGroup=function(d,e,f){return 0===a?!0:(b.r-d)*(b.r-d)+(b.g-e)*(b.g-e)+(b.b-f)*(b.b-f)<=c*c};this.addPixel=function(d,c,f){b.r=(b.r*a+d)/(a+1);b.g=(b.g*a+c)/(a+1);b.b=(b.b*a+f)/(a+1);a+=1}}}();
wpd.colorAnalyzer=function(){return{getTopColors:function(c){var a=[],b,d,e,f,g,h,k=[];a[0]=new wpd.ColorGroup(120);for(b=0;b<c.data.length;b+=4){d=c.data[b];e=c.data[b+1];f=c.data[b+2];g=c.data[b+3];0===g&&(f=e=d=255);h=!1;for(g=0;g<a.length;g++)if(a[g].isColorInGroup(d,e,f)){a[g].addPixel(d,e,f);h=!0;break}h||(a[a.length]=new wpd.ColorGroup(120),a[a.length-1].addPixel(d,e,f))}a.sort(function(a,b){return a.getPixelCount()>b.getPixelCount()?-1:a.getPixelCount()<b.getPixelCount()?1:0});for(g=0;g<a.length;g++)b=
a[g].getAverageColor(),k[g]={r:parseInt(b.r,10),g:parseInt(b.g,10),b:parseInt(b.b,10),pixels:a[g].getPixelCount(),percentage:100*a[g].getPixelCount()/(.25*c.data.length)};return k}}}();wpd=wpd||{};
wpd.ConnectedPoints=function(){return function(c){var a=[],b=-1,d=-1;this.addConnection=function(b){a[a.length]=b};this.clearAll=function(){a=[]};this.getConnectionAt=function(b){if(b<a.length)return a[b]};this.replaceConnectionAt=function(b,d){b<a.length&&(a[b]=d)};this.deleteConnectionAt=function(b){b<a.length&&a.splice(b,1)};this.connectionCount=function(){return a.length};this.getDistance=function(b){if(b<a.length&&2===c)return Math.sqrt((a[b][0]-a[b][2])*(a[b][0]-a[b][2])+(a[b][1]-a[b][3])*(a[b][1]-
a[b][3]))};this.getAngle=function(b){if(b<a.length&&3===c){var d=wpd.taninverse(-(a[b][5]-a[b][3]),a[b][4]-a[b][2]);b=wpd.taninverse(-(a[b][1]-a[b][3]),a[b][0]-a[b][2]);d=180*(d-b)/Math.PI;return d=0>d?d+360:d}};this.getOpenSpline=function(a){return null};this.getClosedSpline=function(a){return null};this.openPathLength=function(a){return 0};this.closedPathLength=function(a){return 0};this.closedPathArea=function(a){return 0};this.findNearestPointAndConnection=function(b,d){var g=-1,h=-1,k,m,l,n;
for(l=0;l<a.length;l++)for(n=0;n<2*c;n+=2)if(m=(a[l][n]-b)*(a[l][n]-b)+(a[l][n+1]-d)*(a[l][n+1]-d),-1===h||m<k)g=l,h=n/2,k=m;return{connectionIndex:g,pointIndex:h}};this.selectNearestPoint=function(a,c){var g=this.findNearestPointAndConnection(a,c);0<=g.connectionIndex&&(b=g.connectionIndex,d=g.pointIndex)};this.deleteNearestConnection=function(a,b){var d=this.findNearestPointAndConnection(a,b);0<=d.connectionIndex&&this.deleteConnectionAt(d.connectionIndex)};this.isPointSelected=function(a,c){return d===
c&&b===a?!0:!1};this.getSelectedConnectionAndPoint=function(){return{connectionIndex:b,pointIndex:d}};this.unselectConnectionAndPoint=function(){d=b=-1};this.setPointAt=function(b,d,c,h){a[b][2*d]=c;a[b][2*d+1]=h};this.getPointAt=function(b,d){return{x:a[b][2*d],y:a[b][2*d+1]}}}}();wpd=wpd||{};
wpd.DataSeries=function(){return function(c){var a=[],b=[],d=!1,e=[];this.name="Default Dataset";this.variableNames=[];this.variableIds=[];this.hasMetadata=function(){return d};this.setMetadataKeys=function(a){e=a};this.getMetadataKeys=function(){return e};this.addPointField=function(b,d){a.push({name:b,map_id:d})};this.editPointField=function(b,d,c){a[c]={name:b,map_id:d}};this.deletePointField=function(b){a.splice(b)};this.addPixel=function(a,b,d,c){a={x:a,y:b,metadata:d,extraVars:c};!c&&2<this.variableIds.length?
(wpd.popup.show("extra-variable-prompt"),wpd.findElement("pointData").val(JSON.stringify(a))):this.addPointData(a)};this.addPointData=function(b){a[a.length]=b;null!=b.metadata&&(d=!0);wpd.dataPointCounter.setCount();window.dispatchEvent(wpd.DataChangeEvent)};this.getPixel=function(b){return a[b]};this.setPixelAt=function(b,d,c){b<a.length&&(a[b].x=d,a[b].y=c);window.dispatchEvent(wpd.DataChangeEvent)};this.setMetadataAt=function(b,d){b<a.length&&(a[b].metadata=d)};this.insertPixel=function(b,d,c,
e){a.splice(b,0,{x:d,y:c,metadata:e})};this.removePixelAtIndex=function(b){b<a.length&&a.splice(b,1);window.dispatchEvent(wpd.DataChangeEvent)};this.removeLastPixel=function(){this.removePixelAtIndex(a.length-1)};this.findNearestPixel=function(b,d,c){c=null==c?50:parseFloat(c);var e,m=-1,l,n;for(l=0;l<a.length;l++)if(n=Math.sqrt((b-a[l].x)*(b-a[l].x)+(d-a[l].y)*(d-a[l].y)),0>m&&n<=c||0<=m&&n<e)m=l,e=n;return m};this.removeNearestPixel=function(a,b,d){a=this.findNearestPixel(a,b,d);0<=a&&this.removePixelAtIndex(a)};
this.clearAll=function(){a=[];d=!1;e=[];window.dispatchEvent(wpd.DataChangeEvent)};this.getCount=function(){return a.length};this.selectPixel=function(a){0<=b.indexOf(a)||(b[b.length]=a)};this.unselectAll=function(){b=[]};this.selectNearestPixel=function(a,b,d){a=this.findNearestPixel(a,b,d);0<=a&&this.selectPixel(a);return a};this.selectNextPixel=function(){for(var d=0;d<b.length;d++)b[d]=(b[d]+1)%a.length};this.selectPreviousPixel=function(){var d,c;for(d=0;d<b.length;d++)c=b[d],c=0===c?a.length-
1:c-1,b[d]=c};this.getSelectedPixels=function(){return b};this.removeExtraVariableFromData=function(b){for(var d=0;d<a.length;d++)a[d].extraVars.splice(b,1),0==a[d].extraVars.length&&delete a[d].extraVars};this.validateExtraAndClose=function(){for(var a=!1,b=2;b<wpd.dataSeriesManagement.activeDataSeries.variableIds.length;b++)if(""==wpd.findElement("extra_var_"+wpd.dataSeriesManagement.activeDataSeries.variableIds[b]).val()){a=!0;break}if(a)alert("Please enter a value for each variable.");else{a=
JSON.parse(wpd.findElement("pointData").val());void 0===a.extraVars&&(a.extraVars=[]);wpd.findElement("pointData").val("");for(b=2;b<wpd.dataSeriesManagement.activeDataSeries.variableIds.length;b++)a.extraVars.push($wpd.findElement("extra_var_"+wpd.dataSeriesManagement.activeDataSeries.variableIds[b]).val()),wpd.findElement("extra_var_"+wpd.dataSeriesManagement.activeDataSeries.variableIds[b]).val("");wpd.popup.close("extra-variable-prompt");this.addPointData(a)}}}}();wpd=wpd||{};
wpd.dateConverter=function(){function c(a){a=a.toString();var d=a.split("/"),c;if(0>=d.length||3<d.length)return null;a=parseInt(d[0],10);c=parseInt(void 0===d[1]?0:d[1],10);date=parseInt(void 0===d[2]?1:d[2],10);if(isNaN(a)||isNaN(c)||isNaN(date)||12<c||1>c||31<date||1>date)return null;d=new Date;d.setUTCFullYear(a);d.setUTCMonth(c-1);d.setUTCDate(date);a=parseFloat(Date.parse(d));return isNaN(a)?null:a}function a(a,d){var c;c=d.replace("YYYY","yyyy");c=c.replace("YY","yy");c=c.replace("MMMM","mmmm");
c=c.replace("MMM","mmm");c=c.replace("MM","mm");c=c.replace("DD","dd");c=c.replace("yyyy",a.getUTCFullYear());var f=a.getUTCFullYear()%100;c=c.replace("yy",10>f?"0"+f:f);c=c.replace("mmmm","January February March April May June July August September October November December".split(" ")[a.getUTCMonth()]);c=c.replace("mmm","Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")[a.getUTCMonth()]);c=c.replace("mm",a.getUTCMonth()+1);return c=c.replace("dd",a.getUTCDate())}return{parse:function(a){return null==
a||"string"===typeof a&&0>a.indexOf("/")?null:c(a)},getFormatString:function(a){a=a.split("/");var d="yyyy/mm/dd";1<=a.length&&(d="yyyy");2<=a.length&&(d+="/mm");3===a.length&&(d+="/dd");return d},formatDate:a,formatDateNumber:function(b,d){var c;c=parseFloat(b);c=parseInt(864E5*Math.round(c/864E5),10);return a(new Date(c),d)}}}();wpd=wpd||{};
wpd.gridDetectionCore=function(){var c,a,b=.1,d=.1;return{run:function(){var e=[],f,g,h=wpd.appData.getPlotData().getAutoDetector(),k=h.gridMask.xmin,m=h.gridMask.xmax,l=h.gridMask.ymin,n=h.gridMask.ymax,p=h.imageWidth,q;if(a)for(f=k;f<=m;f++){q=0;for(g=l;g<n;g++)!0===h.gridBinaryData[g*p+f]&&q++;if(q>d*(n-l))for(g=l;g<n;g++)e[g*p+f]=!0}if(c)for(g=l;g<=n;g++){q=0;for(f=k;f<=m;f++)!0===h.gridBinaryData[g*p+f]&&q++;if(q>b*(m-k))for(f=k;f<=m;f++)e[g*p+f]=!0}wpd.appData.getPlotData().gridData=e},setHorizontalParameters:function(a,
b){c=a;d=Math.abs(parseFloat(b)/100)},setVerticalParameters:function(d,c){a=d;b=Math.abs(parseFloat(c)/100)}}}();wpd=wpd||{};
wpd.InputParser=function(){return function(){this.parse=function(c){this.isDate=this.isValid=!1;this.formatting=null;if(null==c||"string"===typeof c&&(c=c.trim(),0<=c.indexOf("^")))return null;var a=wpd.dateConverter.parse(c);if(null!=a)return this.isDate=this.isValid=!0,this.formatting=wpd.dateConverter.getFormatString(c),a;c=parseFloat(c);return isNaN(c)?null:(this.isValid=!0,c)};this.isDate=this.isValid=!1;this.formatting=null}}();wpd=wpd||{};
wpd.taninverse=function(c,a){var b;0<c?b=Math.atan2(c,a):0>=c&&(b=Math.atan2(c,a)+2*Math.PI);b>=2*Math.PI&&(b=0);return b};wpd.sqDist2d=function(c,a,b,d){return(c-b)*(c-b)+(a-d)*(a-d)};wpd.sqDist3d=function(c,a,b,d,e,f){return(c-d)*(c-d)+(a-e)*(a-e)+(b-f)*(b-f)};wpd.dist2d=function(c,a,b,d){return Math.sqrt(wpd.sqDist2d(c,a,b,d))};wpd.dist3d=function(c,a,b,d,e,f){return Math.sqrt(wpd.sqDist3d(c,a,b,d,e,f))};
wpd.mat=function(){function c(a){return a[0]*a[3]-a[1]*a[2]}return{det2x2:c,inv2x2:function(a){var b=c(a);return[a[3]/b,-a[1]/b,-a[2]/b,a[0]/b]},mult2x2:function(a,b){return[a[0]*b[0]+a[1]*b[2],a[0]*b[1]+a[1]*b[3],a[2]*b[0]+a[3]*b[2],a[2]*b[1]+a[3]*b[3]]},mult2x2Vec:function(a,b){return[a[0]*b[0]+a[1]*b[1],a[2]*b[0]+a[3]*b[1]]},multVec2x2:function(a,b){return[b[0]*a[0]+b[2]*a[1],b[1]*a[0]+b[3]*a[1]]}}}();
wpd.cspline=function(c,a){var b=c.length,d={x:c,y:a,len:b,d:[]},e=[],f=[],g;if(3>b)return null;f[0]=2;e[0]=3*(a[1]-a[0]);for(g=1;g<b-1;++g)f[g]=4-1/f[g-1],e[g]=3*(a[g+1]-a[g-1])-e[g-1]/f[g-1];f[b-1]=2-1/f[b-2];e[b-1]=3*(a[b-1]-a[b-2])-e[b-2]/f[b-1];g=b-1;for(d.d[g]=e[g]/f[g];0<g;)--g,d.d[g]=(e[g]-d.d[g+1])/f[g];return d};
wpd.cspline_interp=function(c,a){var b=0,d;if(a>=c.x[c.len-1]||a<c.x[0])return null;for(;a>c.x[b];)b++;b=0<b?b-1:0;d=(a-c.x[b])/(c.x[b+1]-c.x[b]);return c.y[b]+c.d[b]*d+(3*(c.y[b+1]-c.y[b])-2*c.d[b]-c.d[b+1])*d*d+(2*(c.y[b]-c.y[b+1])+c.d[b]+c.d[b+1])*d*d*d};wpd=wpd||{};
wpd.PlotData=function(){return function(){var c=0,a=new wpd.AutoDetector;this.axes=this.topColors=null;this.dataSeriesColl=[];this.backupImageData=this.closedPathMeasurementData=this.openPathMeasurementData=this.distanceMeasurementData=this.angleMeasurementData=this.calibration=this.gridData=null;this.getActiveDataSeries=function(){null==this.dataSeriesColl[c]&&(this.dataSeriesColl[c]=new wpd.DataSeries);return this.dataSeriesColl[c]};this.getDataSeriesCount=function(){return this.dataSeriesColl.length};
this.setActiveDataSeriesIndex=function(a){c=a};this.getActiveDataSeriesIndex=function(){return c};this.getAutoDetector=function(){return a};this.getDataSeriesNames=function(){for(var a=[],d=0;d<this.dataSeriesColl.length;d++)a[d]=this.dataSeriesColl[d].name;return a};this.reset=function(){this.closedPathMeasurementData=this.openPathMeasurementData=this.distanceMeasurementData=this.angleMeasurementData=this.axes=null;this.dataSeriesColl=[];this.backupImageData=this.calibration=this.gridData=null;c=
0;a=new wpd.AutoDetector}}}();wpd=wpd||{};
wpd.AveragingWindowCore=function(){return function(c,a,b,d,e,f){this.run=function(){var g=[],h=0,k=[],m,l,n,p,q,u,t,r,v;f.clearAll();for(m=0;m<b;m++){q=-1;n=-2*e;for(l=p=0;l<a;l++)!0===c[l*b+m]&&(l>n+e?(q+=1,p=1,n=k[q]=l):(p+=1,k[q]=parseFloat((k[q]*(p-1)+l)/parseFloat(p))));if(0<=q)for(n=m+.5,l=0;l<=q;l++)p=k[l]+.5,g[h]=[],g[h][0]=parseFloat(n),g[h][1]=parseFloat(p),g[h][2]=!0,h+=1}if(0!==h){for(k=0;k<h;k++)if(!0===g[k][2]){m=!0;q=k+1;l=g[k][0];n=g[k][1];p=l;u=n;for(v=1;!0===m&&q<h;)t=g[q][0],r=
g[q][1],Math.abs(t-l)<=d&&Math.abs(r-n)<=e&&!0===g[q][2]&&(p=(p*v+t)/(v+1),u=(u*v+r)/(v+1),v+=1,g[q][2]=!1),t>l+2*d&&(m=!1),q+=1;g[k][2]=!1;f.addPixel(parseFloat(p),parseFloat(u))}return f}}}}();wpd=wpd||{};
wpd.AveragingWindowAlgo=function(){return function(){var c=5,a=5;this.getParamList=function(){return[["\u0394X","Px",10],["\u0394Y","Px",10]]};this.setParam=function(b,d){0===b?c=d:1===b&&(a=d)};this.run=function(b){var d=b.getAutoDetector();b=b.getActiveDataSeries();(new wpd.AveragingWindowCore(d.binaryData,d.imageHeight,d.imageWidth,c,a,b)).run()}}}();wpd=wpd||{};
wpd.AveragingWindowWithStepSizeAlgo=function(){return function(){var c,a,b,d,e,f;this.getParamList=function(){var a=wpd.appData.isAligned(),b=wpd.appData.getPlotData().axes;return a&&b instanceof wpd.XYAxes?(a=b.getBounds(),[["X_min","Units",a.x1],["\u0394X Step","Units",.1],["X_max","Units",a.x2],["Y_min","Units",a.y3],["Y_max","Units",a.y4],["Line width","Px",30]]):[["X_min","Units",0],["\u0394X Step","Units",.1],["X_max","Units",0],["Y_min","Units",0],["Y_max","Units",0],["Line width","Px",30]]};
this.setParam=function(g,h){0===g?c=h:1===g?a=h:2===g?b=h:3===g?e=h:4===g?f=h:5===g&&(d=h)};this.run=function(g){var h=g.getAutoDetector(),k=g.getActiveDataSeries();g=g.axes;var m=h.imageWidth,l=h.imageHeight,n,p,q,u,t,r,v,w,x;k.clearAll();for(n=c;n<=b;n+=a)for(x=g.dataToPixel(n,e),p=x.x,u=x.y,x=g.dataToPixel(n,f),q=x.x,t=x.y,p=Math.sqrt((t-u)*(t-u)+(q-p)*(q-p)),q=(f-e)/p,u=!1,r=t=0,v=!1,w=0;w<=p;w++)x=1*-w*q+f,x=g.dataToPixel(n,x),xi_pix=x.x,yi_pix=x.y,0<=xi_pix&&xi_pix<m&&0<=yi_pix&&yi_pix<l&&(!0===
h.binaryData[parseInt(yi_pix,10)*m+parseInt(xi_pix,10)]?(!1===u&&(r=t=w,u=!0,v=!1),!0===v&&(r=w,v=!1)):!1===v&&(r=w,v=!0),!0===u&&(w>t+d||w==p-1)&&(u=!1,t>r&&(r=w),x=(t+r)/2,x=1*-x*q+f,x=g.dataToPixel(n,x),k.addPixel(parseFloat(x.x),parseFloat(x.y))))}}}();wpd=wpd||{};
wpd.BarValue=function(){this.avgX=this.avgValBot=this.avgValTop=this.npoints=0;this.append=function(c,a,b){this.avgX=(this.npoints*this.avgX+c)/(this.npoints+1);this.avgValTop=(this.npoints*this.avgValTop+a)/(this.npoints+1);this.avgValBot=(this.npoints*this.avgValBot+b)/(this.npoints+1);this.npoints++};this.isPointInGroup=function(c,a,b,d,e){return 0===this.npoints||Math.abs(this.avgX-c)<=d&&Math.abs(this.avgValTop-a)<=e&&Math.abs(this.avgValBot-b)<=e?!0:!1}};
wpd.BarExtractionAlgo=function(){var c,a;this.getParamList=function(){return"Y"===wpd.appData.getPlotData().axes.getOrientation().axes?[["\u0394X","Px",30],["\u0394Val","Px",10]]:[["\u0394Y","Px",30],["\u0394Val","Px",10]]};this.setParam=function(b,d){0===b?c=parseFloat(d):1===b&&(a=parseFloat(d))};this.run=function(b){var d=b.getAutoDetector(),e=b.getActiveDataSeries(),f=b.axes.getOrientation(),g=[],h,k,m,l,n,p=d.imageWidth,q=d.imageHeight,u,t,r,v=function(b,d,e){u=!1;for(t=0;t<g.length;t++)if(r=
g[t],r.isPointInGroup(b,d,e,c,a)){r.append(b,d,e);u=!0;break}u||(r=new wpd.BarValue,r.append(b,d,e),g.push(r))};e.clearAll();if("Y"===f.axes)for(l=0;l<p;l++){h=0;k=q-1;for(n=m=0;n<q;n++)if(d.binaryData[n*p+l]){h=n;m++;break}for(n=q-1;0<=n;n--)if(d.binaryData[n*p+l]){k=n;m++;break}2===m&&v(l,h,k)}else for(n=0;n<q;n++){h=p-1;m=k=0;for(l=p-1;0<=l;l--)if(d.binaryData[n*p+l]){h=l;m++;break}for(l=0;l<p;l++)if(d.binaryData[n*p+l]){k=l;m++;break}2===m&&v(n,h,k)}b.axes.dataPointsHaveLabels&&(d=e.getMetadataKeys(),
null!=d&&"Label"===d[0]||e.setMetadataKeys(["Label"]));for(t=0;t<g.length;t++)r=g[t],"Y"===f.axes?(h=b.axes.pixelToData(r.avgX,r.avgValTop)[0],k=b.axes.pixelToData(r.avgX,r.avgValBot)[0]):(h=b.axes.pixelToData(r.avgValTop,r.avgX)[0],k=b.axes.pixelToData(r.avgValBot,r.avgX)[0]),d=0>h+k?"increasing"===f.direction?r.avgValBot:r.avgValTop:"increasing"===f.direction?r.avgValTop:r.avgValBot,b.axes.dataPointsHaveLabels?"Y"===f.axes?e.addPixel(r.avgX+.5,d+.5,["Bar"+t]):e.addPixel(d+.5,r.avgX+.5,["Bar"+t]):
"Y"===f.axes?e.addPixel(r.avgX+.5,d+.5):e.addPixel(d+.5,r.avgX+.5)}};wpd=wpd||{};
wpd.BlobDetectorAlgo=function(){return function(){var c,a;this.getParamList=function(){var a=wpd.appData.isAligned(),d=wpd.appData.getPlotData().axes;return a&&d instanceof wpd.MapAxes?[["Min Diameter","Units",0],["Max Diameter","Units",5E3]]:[["Min Diameter","Px",0],["Max Diameter","Px",5E3]]};this.setParam=function(b,d){0===b?c=parseFloat(d):1===b&&(a=parseFloat(d))};this.run=function(b){var d=b.getAutoDetector(),e=b.getActiveDataSeries(),f=d.imageWidth,g=d.imageHeight,h=[],k=[],m,l,n,p,q,u,t,r,
v;if(!(0>=f||0>=g||null==d.binaryData||0===d.binaryData.length)){e.clearAll();e.setMetadataKeys(["area","moment"]);for(m=0;m<f;m++)for(l=0;l<g;l++)if(!0===d.binaryData[l*f+m]&&!0!==h[l*f+m])for(h[l*f+m]=!0,p=k.length,k[p]={pixels:[{x:m,y:l}],centroid:{x:m,y:l},area:1,moment:0},n=0;n<k[p].pixels.length;){t=k[p].pixels[n].x;r=k[p].pixels[n].y;for(q=t-1;q<=t+1;q++)for(u=r-1;u<=r+1;u++)0<=q&&0<=u&&q<f&&u<g&&!0!==h[u*f+q]&&!0===d.binaryData[u*f+q]&&(h[u*f+q]=!0,v=k[p].pixels.length,k[p].pixels[v]={x:q,
y:u},k[p].centroid.x=(k[p].centroid.x*v+q)/(v+1),k[p].centroid.y=(k[p].centroid.y*v+u)/(v+1),k[p].area+=1);n+=1}for(p=0;p<k.length;p++){for(n=k[p].moment=0;n<k[p].pixels.length;n++)k[p].moment=k[p].moment+(k[p].pixels[n].x-k[p].centroid.x)*(k[p].pixels[n].x-k[p].centroid.x)+(k[p].pixels[n].y-k[p].centroid.y)*(k[p].pixels[n].y-k[p].centroid.y);b.axes instanceof wpd.MapAxes&&(k[p].area=b.axes.pixelToDataArea(k[p].area));d=2*Math.sqrt(k[p].area/Math.PI);d<=a&&d>=c&&e.addPixel(k[p].centroid.x+.5,k[p].centroid.y+
.5,[k[p].area,k[p].moment])}}}}}();wpd=wpd||{};
wpd.XStepWithInterpolationAlgo=function(){return function(){var c,a,b,d,e,f;this.getParamList=function(){var a=wpd.appData.isAligned(),b=wpd.appData.getPlotData().axes;return a&&b instanceof wpd.XYAxes?(a=b.getBounds(),[["X_min","Units",a.x1],["\u0394X Step","Units",(a.x2-a.x1)/50],["X_max","Units",a.x2],["Y_min","Units",a.y3],["Y_max","Units",a.y4],["Smoothing","% of \u0394X",0]]):[["X_min","Units",0],["\u0394X Step","Units",.1],["X_max","Units",0],["Y_min","Units",0],["Y_max","Units",0],["Smoothing",
"% of \u0394X",0]]};this.setParam=function(g,h){0===g?c=h:1===g?a=h:2===g?b=h:3===g?e=h:4===g?f=h:5===g&&(d=h)};this.run=function(g){var h=g.getAutoDetector(),k=g.getActiveDataSeries();g=g.axes;var m=0,l=h.imageWidth,n=h.imageHeight,p,q,u,t,r,v,w=[],x=[];v=[];var z=[],A=Math.abs(d/100*a);k.clearAll();p=g.dataToPixel(c,e);q=g.dataToPixel(c,f);q=Math.sqrt((p.x-q.x)*(p.x-q.x)+(p.y-q.y)*(p.y-q.y));z=(f-e)/q;q=g.dataToPixel(b,e);p=Math.sqrt((p.x-q.x)*(p.x-q.x)+(p.y-q.y)*(p.y-q.y));q=(b-c)/p;0<Math.abs(A/
q)&&1>Math.abs(A/q)&&(A=q);for(p=c;0<q&&p<=b||0>q&&p>=b;){r=t=0;for(u=e;0<z&&u<=f||0>z&&u>=f;)v=g.dataToPixel(p,u),0<v.x&&0<v.y&&v.x<l&&v.y<n&&!0===h.binaryData[parseInt(v.y,10)*l+parseInt(v.x,10)]&&(t=(t*r+u)/parseFloat(r+1),r++),u+=z;0<r&&(w[m]=parseFloat(p),x[m]=parseFloat(t),m+=1);p+=q}if(!(0>=w.length||0>=x.length)){if(0<A)for(v=[],z=[],p=w[0];0<q&&p<=w[w.length-1]||0>q&&p>=w[w.length-1];){for(h=r=l=m=0;h<w.length;h++)w[h]<=p+A&&w[h]>=p-A&&(m=(m*r+w[h])/parseFloat(r+1),l=(l*r+x[h])/parseFloat(r+
1),r++);0<r&&(v[v.length]=m,z[z.length]=l);p=0<q?p+A:p-A}else v=w,z=x;if(!(0>=v.length||0>=z.length||(w=[],h=0,p=c,0>q&&0<a||0<q&&0>a))){for(;0<q&&p<=b||0>q&&p>=b;)w[h]=p,h++,p+=a;0>q&&(v=v.reverse(),z=z.reverse());A=wpd.cspline(v,z);if(null!=A)for(x=[],h=0;h<w.length;++h)isNaN(w[h])||(x[h]=wpd.cspline_interp(A,w[h]),null!==x[h]&&(v=g.dataToPixel(w[h],x[h]),k.addPixel(v.x,v.y)))}}}}}();wpd=wpd||{};
wpd.BarAxes=function(){var c=function(){var a=!1,b=!1,d,c,f,g,h,k,m;this.isCalibrated=function(){return a};this.calibrate=function(l,n){a=!1;var p=l.getPoint(0),q=l.getPoint(1);d=p.px;c=p.py;f=q.px;g=q.py;h=parseFloat(p.dy);k=parseFloat(q.dy);n?(b=!0,h=Math.log(h)/Math.log(10),k=Math.log(k)/Math.log(10)):b=!1;m=this.calculateOrientation();return a=!0};this.pixelToData=function(a,n){var m=[];m[0]=((n-c)*(g-c)+(f-d)*(a-d))/((g-c)*(g-c)+(f-d)*(f-d))*(k-h)+h;b&&(m[0]=Math.pow(10,m[0]));return m};this.dataToPixel=
function(a,b){return{x:0,y:0}};this.pixelToLiveString=function(a,b){return this.pixelToData(a,b)[0].toExponential(4)};this.isLog=function(){return b};this.getTransformationEquations=function(){return{pixelToData:["This will be available in a future release."]}};this.dataPointsHaveLabels=!0;this.dataPointsLabelPrefix="Bar";this.calculateOrientation=function(){var a=180*wpd.taninverse(-(g-c),f-d)/Math.PI,b={axes:"Y",direction:"increasing",angle:a};30>Math.abs(a-90)?(b.axes="Y",b.direction="increasing"):
30>Math.abs(a-270)?(b.axes="Y",b.direction="decreasing"):30>Math.abs(a-0)||30>Math.abs(a-360)?(b.axes="X",b.direction="increasing"):30>Math.abs(a-180)&&(b.axes="X",b.direction="decreasing");return b};this.getOrientation=function(){return m}};c.prototype.numCalibrationPointsRequired=function(){return 2};c.prototype.getDimensions=function(){return 2};c.prototype.getAxesLabels=function(){return["Label","Y"]};return c}();wpd=wpd||{};
wpd.ImageAxes=function(){var c=function(){this.isCalibrated=function(){return!0};this.calibrate=function(){return!0};this.pixelToData=function(a,b){return[a,b]};this.dataToPixel=function(a,b){return{x:a,y:b}};this.pixelToLiveString=function(a,b){var d=this.pixelToData(a,b);return d[0].toFixed(2)+", "+d[1].toFixed(2)};this.getTransformationEquations=function(){return{pixelToData:["x_data = x_pixel","y_data = y_pixel"],dataToPixel:["x_pixel = x_data","y_pixel = y_data"]}}};c.prototype.numCalibrationPointsRequired=
function(){return 0};c.prototype.getDimensions=function(){return 2};c.prototype.getAxesLabels=function(){return["X","Y"]};return c}();wpd=wpd||{};
wpd.MapAxes=function(){var c=function(){var a=!1,b,d,c;this.isCalibrated=function(){return a};this.calibrate=function(f,g,h){var k=f.getPoint(0);f=f.getPoint(1);c=Math.sqrt((k.px-f.px)*(k.px-f.px)+(k.py-f.py)*(k.py-f.py));b=parseFloat(g);d=h;return a=!0};this.pixelToData=function(a,d){var h=[];h[0]=a*b/c;h[1]=d*b/c;return h};this.pixelToDataDistance=function(a){return a*b/c};this.pixelToDataArea=function(a){return a*b*b/(c*c)};this.dataToPixel=function(a,b,c){return{x:0,y:0}};this.pixelToLiveString=
function(a,b){var c=this.pixelToData(a,b);return c[0].toExponential(4)+", "+c[1].toExponential(4)};this.getScaleLength=function(){return b};this.getUnits=function(){return d};this.getTransformationEquations=function(){return{pixelToData:["x_data = "+b/c+"*x_pixel","y_data = "+b/c+"*y_pixel"],dataToPixel:["x_pixel = "+c/b+"*x_data","y_pixel = "+c/b+"*y_data"]}}};c.prototype.numCalibrationPointsRequired=function(){return 2};c.prototype.getDimensions=function(){return 2};c.prototype.getAxesLabels=function(){return["X",
"Y"]};return c}();wpd=wpd||{};
wpd.PolarAxes=function(){var c=function(){var a=!1,b=!1,c=!1,e=!1,f,g,h,k,m,l,n,p,q,u,t,r,v,w;processCalibration=function(a,z,A,B){var G=a.getPoint(0),M=a.getPoint(1);a=a.getPoint(2);f=G.px;g=G.py;h=M.px;k=M.py;m=a.px;l=a.py;n=M.dx;p=M.dy;q=a.dx;b=z;c=A;!0===b&&(p*=Math.PI/180);B&&(e=!0,n=Math.log(n)/Math.log(10),q=Math.log(q)/Math.log(10));u=Math.sqrt((h-f)*(h-f)+(k-g)*(k-g));t=Math.sqrt((m-f)*(m-f)+(l-g)*(l-g));r=t-u;v=wpd.taninverse(-(k-g),h-f);w=c?v+p:v-p;return!0};this.isCalibrated=function(){return a};
this.calibrate=function(b,c,d,e){return a=processCalibration(b,c,d,e)};this.isThetaDegrees=function(){return b};this.isThetaClockwise=function(){return c};this.pixelToData=function(a,h){var k=[],m,l;xp=parseFloat(a);yp=parseFloat(h);m=(q-n)/r*(Math.sqrt((xp-f)*(xp-f)+(yp-g)*(yp-g))-u)+n;l=c?w-wpd.taninverse(-(yp-g),xp-f):wpd.taninverse(-(yp-g),xp-f)-w;0>l&&(l+=2*Math.PI);!0===b&&(l=180*l/Math.PI);e&&(m=Math.pow(10,m));k[0]=m;k[1]=l;return k};this.dataToPixel=function(a,b){return{x:0,y:0}};this.pixelToLiveString=
function(a,b){var c=this.pixelToData(a,b);return c[0].toExponential(4)+", "+c[1].toExponential(4)};this.getTransformationEquations=function(){var a="r = ("+(q-n)/r+")*sqrt((x_pixel - "+f+")^2 + (y_pixel - "+g+")^2) + ("+(n-u*(q-n)/r)+")",e;e=c?w-NaN+g+" - y_pixel), (x_pixel - "+f+"))":"atan2(("+g+" - y_pixel), (x_pixel - "+f+")) - ("+w+")";e=b?"theta = (180/PI)*("+e+"), theta = theta + 360 if theta < 0":"theta = "+e+" theta = theta + 2*PI if theta < 0";return{pixelToData:[a,e]}}};c.prototype.numCalibrationPointsRequired=
function(){return 3};c.prototype.getDimensions=function(){return 2};c.prototype.getAxesLabels=function(){return["r","\u03b8"]};return c}();wpd=wpd||{};
wpd.TernaryAxes=function(){var c=function(){var a=!1,b,c,e,f,g,h,k,m,l;this.isCalibrated=function(){return a};this.calibrate=function(n,p,q){var u=n.getPoint(0),t=n.getPoint(1);n.getPoint(2);b=u.px;c=u.py;e=t.px;f=t.py;g=Math.sqrt((b-e)*(b-e)+(c-f)*(c-f));h=wpd.taninverse(-(f-c),e-b);k=Math.sqrt(3);m=p;l=q;return a=!0};this.isRange100=function(){return m};this.isNormalOrientation=function(){return l};this.pixelToData=function(a,e){var f=[],u,t,r,v;xp=parseFloat(a);yp=parseFloat(e);u=Math.sqrt((xp-
b)*(xp-b)+(yp-c)*(yp-c));t=wpd.taninverse(-(yp-c),xp-b)-h;r=u*Math.cos(t)/g;t=u*Math.sin(t)/g;u=1-r-t/k;r-=t/k;t=2*t/k;0==l&&(v=r,r=u,u=t,t=v);1==m&&(u*=100,r*=100,t*=100);f[0]=u;f[1]=r;f[2]=t;return f};this.dataToPixel=function(a,b,c){return{x:0,y:0}};this.pixelToLiveString=function(a,b){var c=this.pixelToData(a,b);return c[0].toExponential(4)+", "+c[1].toExponential(4)+", "+c[2].toExponential(4)};this.getTransformationEquations=function(){var a="rp = sqrt((x_pixel - "+b+")^2 + (y_pixel - "+c+")^2)/("+
g+")",h="thetap = atan2(("+c+" -  y_pixel), (x_pixel - "+b+")) - ("+Math.atan2(-(f-c),e-b)+")",k="1 - rp*(cos(thetap) - sin(thetap)/sqrt(3))",u="rp*(cos(thetap) - sin(thetap)/sqrt(3))",t="2*rp*sin(thetap)/sqrt(3)",r;m&&(k="100*("+k+")",u="100*("+u+")",t="100*("+t+")");k="a_data = "+k;u="b_data = "+u;t="c_data = "+t;l||(r=u,u=k,k=t,t=r);return{pixelToData:[a,h,k,u,t]}}};c.prototype.numCalibrationPointsRequired=function(){return 3};c.prototype.getDimensions=function(){return 3};c.prototype.getAxesLabels=
function(){return["a","b","c"]};return c}();wpd=wpd||{};
wpd.XYAxes=function(){var c=function(){var a=!1,b=!1,c=!1,e=!1,f=!1,g,h,k,m,l,n,p,q,u,t,r,v,w,x,z=[0,0,0,0],A=[0,0,0,0],B=[0,0],G=function(a,J,H){if(4>a.getCount())return!1;var L=a.getPoint(0),I=a.getPoint(1),G=a.getPoint(2);a=a.getPoint(3);var F=new wpd.InputParser;k=L.px;p=L.py;m=I.px;q=I.py;l=G.px;u=G.py;n=a.px;t=a.py;r=L.dx;v=I.dx;w=G.dy;x=a.dy;r=F.parse(r);if(!F.isValid)return!1;e=F.isDate;v=F.parse(v);if(!F.isValid||F.isDate!=e)return!1;g=F.formatting;w=F.parse(w);if(!F.isValid)return!1;f=F.isDate;
x=F.parse(x);if(!F.isValid||F.isDate!=f)return!1;h=F.formatting;b=J;c=H;!0===b&&(r=Math.log(r)/Math.log(10),v=Math.log(v)/Math.log(10));!0===c&&(w=Math.log(w)/Math.log(10),x=Math.log(x)/Math.log(10));z=wpd.mat.mult2x2([r-v,0,0,w-x],wpd.mat.inv2x2([k-m,l-n,p-q,u-t]));A=wpd.mat.inv2x2(z);B[0]=r-z[0]*k-z[1]*p;B[1]=w-z[2]*l-z[3]*u;return!0};this.getBounds=function(){return{x1:r,x2:v,y3:w,y4:x}};this.isCalibrated=function(){return a};this.calibrate=function(b,c,d){return a=G(b,c,d)};this.pixelToData=function(a,
e){var f=[],g,h;g=parseFloat(a);h=parseFloat(e);h=wpd.mat.mult2x2Vec(z,[g,h]);h[0]+=B[0];h[1]+=B[1];g=h[0];h=h[1];!0===b&&(g=Math.pow(10,g));!0===c&&(h=Math.pow(10,h));f[0]=g;f[1]=h;return f};this.dataToPixel=function(a,b){var c;c=wpd.mat.mult2x2Vec(A,[a-B[0],b-B[1]]);return{x:c[0],y:c[1]}};this.pixelToLiveString=function(a,b){var c="",d=this.pixelToData(a,b),c=e?c+wpd.dateConverter.formatDateNumber(d[0],g):c+d[0].toExponential(4),c=c+", ";return c=f?c+wpd.dateConverter.formatDateNumber(d[1],h):c+
d[1].toExponential(4)};this.isDate=function(a){return 0===a?e:f};this.getInitialDateFormat=function(a){return 0===a?g:h};this.isLogX=function(){return b};this.isLogY=function(){return c};this.getTransformationEquations=function(){var a="("+z[0]+")*x_pixel + ("+z[1]+")*y_pixel + ("+B[0]+")",e="("+z[2]+")*x_pixel + ("+z[3]+")*y_pixel + ("+B[1]+")",f="x_pixel = ("+A[0]+")*x_data + ("+A[1]+")*y_data + ("+(-A[0]*B[0]-A[1]*B[1])+")",g="y_pixel = ("+A[2]+")*x_data + ("+A[3]+")*y_data + ("+(-A[2]*B[0]-A[3]*
B[1])+")",a=b?"x_data = pow(10, "+a+")":"x_data = "+a,e=c?"y_data = pow(10, "+e+")":"y_data = "+e;return b||c?{pixelToData:[a,e]}:{pixelToData:[a,e],dataToPixel:[f,g]}};this.getOrientation=function(){return{axes:"Y",direction:"increasing",angle:90}}};c.prototype.numCalibrationPointsRequired=function(){return 4};c.prototype.getDimensions=function(){return 2};c.prototype.getAxesLabels=function(){return["X","Y"]};return c}();wpd=wpd||{};
wpd.dataSeriesManagement=function(){function c(){this.populate();wpd.popup.show("manage-data-series-window")}function a(){wpd.graphicsWidget.forceHandlerRepaint();wpd.autoExtraction.updateDatasetControl();wpd.acquireData.updateDatasetControl();wpd.dataPointCounter.setCount()}function b(){wpd.popup.close("manage-data-series-window")}function d(){$("table[name=extra_var_table] tbody tr").remove();for(var a=2;a<wpd.dataSeriesManagement.activeDataSeries.variableNames.length;a++){var b='<tr><td align="right">'+
wpd.dataSeriesManagement.activeDataSeries.variableNames[a]+'</td><td><input type="text" id="extra_var_'+wpd.dataSeriesManagement.activeDataSeries.variableIds[a]+'"></td></tr>';$("table[name=extra_var_table]").find("tbody").append(b)}}function e(){$("table[name=point_field_table] tbody tr").remove();for(var a=0;a<wpd.dataSeriesManagement.activeDataSeries.variableNames.length;a++){a<h.length?(label=h[a]+":",delButton=""):(label="",delButton='<input type="button" value="X" id="delete_point_field_'+a+
'" onClick="wpd.dataSeriesManagement.deleteField(this);">');var b='<tr><td align="right">'+label+"</td><td>"+$(wpd.dataSeriesManagement.pointFieldSelect).clone().attr("id","point_field_value_"+a).prop("outerHTML")+"</td><td>"+delButton+"</td></tr>";$("table[name=point_field_table]").find("tbody").append(b);$(wpd.findElement("point_field_value_"+a)).val(null==wpd.dataSeriesManagement.activeDataSeries.variableIds[a]?0:wpd.dataSeriesManagement.activeDataSeries.variableIds[a])}d()}function f(){for(var a=
!1,b=!1,c=[],e=0;e<wpd.dataSeriesManagement.activeDataSeries.variableNames.length;e++){var f=$(wpd.findElement("point_field_value_"+e)).find(":selected").val();if("0"==f){b=!0;break}if(-1!=$.inArray(f,c)){a=!0;break}c.push(f)}a?alert("Each data point must be assigned a unique measurement value.  Please assign each data point a unique value."):b?alert("All data points must be assigned a measurement value.  Please assign all points a value, or remove unassigned points."):(d(),wpd.popup.close("manage-data-series-window"))}
var g=1,h=null;return{addField:function(a){0<wpd.dataSeriesManagement.activeDataSeries.getCount()?confirm(wpd.gettext("existing-data-text"))&&(wpd.acquireData.confirmedClearAll(),wpd.dataSeriesManagement.activeDataSeries.variableNames.push(null),wpd.dataSeriesManagement.activeDataSeries.variableIds.push(null),e()):(wpd.dataSeriesManagement.activeDataSeries.variableNames.push(null),wpd.dataSeriesManagement.activeDataSeries.variableIds.push(null),e())},addSeries:function(){var d=wpd.appData.getPlotData(),
e="Dataset "+g,f=d.dataSeriesColl.length;b();d.dataSeriesColl[f]=new wpd.DataSeries;d.dataSeriesColl[f].name=e;d.setActiveDataSeriesIndex(f);a();g++;c()},changeSelectedSeries:function(){var d=wpd.findElement("manage-data-series-list"),e=wpd.appData.getPlotData();b();e.setActiveDataSeriesIndex(d.selectedIndex);a();c()},deleteField:function(a){id=parseInt(a.id.substr(a.id.lastIndexOf("_")+1));0<this.activeDataSeries.getCount()?confirm("You have data using this variable.  Removing it will erase the variable from that data.  Do you wish to continue?")&&
(wpd.dataSeriesManagement.activeDataSeries.removeExtraVariableFromData(id-h.length),wpd.dataSeriesManagement.activeDataSeries.variableNames.splice(id,1),wpd.dataSeriesManagement.activeDataSeries.variableIds.splice(id,1),e()):(wpd.dataSeriesManagement.activeDataSeries.removeExtraVariableFromData(id-h.length),wpd.dataSeriesManagement.activeDataSeries.variableNames.splice(id,1),wpd.dataSeriesManagement.activeDataSeries.variableIds.splice(id,1),e())},deleteSeries:function(){b();1===wpd.appData.getPlotData().dataSeriesColl.length?
wpd.messagePopup.show(wpd.gettext("can-not-delete-dataset"),wpd.gettext("can-not-delete-dataset-text"),c):wpd.okCancelPopup.show(wpd.gettext("delete-dataset"),wpd.gettext("delete-dataset-text"),function(){var a=wpd.appData.getPlotData(),b=a.getActiveDataSeriesIndex();a.dataSeriesColl.splice(b,1);a.setActiveDataSeriesIndex(0);c()},function(){c()})},editSeriesName:function(){var d=wpd.appData.getPlotData().getActiveDataSeries(),e=wpd.findElement("manage-data-series-name");b();d.name=e.value;a();c()}.apply,
manage:c,populate:function(){null==h&&(h=["X Value","Y Value"]);if(wpd.appData.isAligned()){var a=wpd.findElement("manage-data-series-name"),b=wpd.findElement("manage-data-series-point-count"),c=wpd.appData.getPlotData();c.getDataSeriesNames();c.getActiveDataSeriesIndex();this.activeDataSeries=c.getActiveDataSeries();null==wpd.dataSeriesManagement.pointFieldSelect?this.pullMeasurementFields(this.populatePointFields.bind(this)):this.populatePointFields();a.value=this.activeDataSeries.name;b.innerHTML=
this.activeDataSeries.getCount()}else wpd.messagePopup.show(wpd.gettext("manage-datasets"),wpd.gettext("manage-datasets-text"))},populatePointFields:function(){0==wpd.dataSeriesManagement.activeDataSeries.variableNames.length?(this.addField(),this.addField()):this.redrawFields()},pullMeasurementFields:function(a){$.ajax({url:"/api/measurement_fields",type:"get",contentType:"application/json; charset=utf-8",success:function(b){for(var c='<select onchange="wpd.dataSeriesManagement.updateField(this);"><option value="0">Select..</option>',
d=0;d<b.length;d++)c+='<option value="'+b[d].id+'">'+b[d].field_name+"</option>";wpd.dataSeriesManagement.pointFieldSelect=c+"</select>";a.call()}})},redrawFields:e,updateField:function(a){id=parseInt(a.id.substr(a.id.lastIndexOf("_")+1));wpd.dataSeriesManagement.activeDataSeries.variableNames[id]=$(wpd.findElement("point_field_value_"+id)).find(":selected").text();wpd.dataSeriesManagement.activeDataSeries.variableIds[id]=$(wpd.findElement("point_field_value_"+id)).find(":selected").val()},validateAndClose:f,
viewData:function(){f();wpd.dataTable.showTable()}}}();wpd=wpd||{};
wpd.dataTable=function(){function c(){wpd.graphicsWidget.removeTool();wpd.popup.show("csvWindow");a()}function a(){g=f.getData();wpd.findElement("data-table-dataset-control");var a=wpd.findElement("data-table-dataset-list"),c=f.getDatasetNames(),h=wpd.findElement("data-sort-variables"),k=wpd.findElement("dataVariables"),q=wpd.findElement("data-date-formatting-container"),u=wpd.findElement("data-date-formatting"),t,r="",v="",w="",x=!1;for(t=0;t<c.length;t++)r+="<option>"+c[t]+"</option>";a.innerHTML=
r;a.selectedIndex=f.getDatasetIndex();k.innerHTML=g.fields.join(", ");q.style.display="none";v+='<option value="raw">'+wpd.gettext("raw")+"</option>";for(t=0;t<g.fields.length;t++)g.isFieldSortable[t]&&(v+='<option value="'+g.fields[t]+'">'+g.fields[t].substring(0,10)+"</option>"),null!=g.fieldDateFormat[t]&&(w+="<p>"+g.fields[t]+' <input type="text" length="15" value="'+g.fieldDateFormat[t]+'" id="data-format-string-'+t+'"/></p>',x=!0);g.allowConnectivity&&(v+='<option value="NearestNeighbor">'+
wpd.gettext("nearest-neighbor")+"</option>");h.innerHTML=v;b();x?(q.style.display="inline-block",u.innerHTML=w):q.style.display="hidden";d();e()}function b(){var a=wpd.findElement("data-sort-variables").value,b=wpd.findElement("data-sort-order");"NearestNeighbor"===a||"raw"===a?b.setAttribute("disabled",!0):b.removeAttribute("disabled")}function d(){if(null!=g&&null!=g.rawData){h=g.rawData.slice(0);var a=wpd.findElement("data-sort-variables").value,b="ascending"===wpd.findElement("data-sort-order").value,
c="NearestNeighbor"===a,d;if("raw"!==a)if(!c)d=g.fields.indexOf(a),0>d||h.sort(function(a,c){return a[d]>c[d]?b?1:-1:a[d]<c[d]?b?-1:1:0});else if(c)for(var e,f,k,r=h.length,v=g.connectivityFieldIndices,w,x,c=0;c<r-1;c++){a=-1;for(k=c+1;k<r;k++){for(w=f=0;w<v.length;w++)x=v[w],f+=(h[c][x]-h[k][x])*(h[c][x]-h[k][x]);if(f<e||-1===a)e=f,a=k}for(w=0;w<g.fields.length;w++)f=h[a][w],h[a][w]=h[c+1][w],h[c+1][w]=f}}}function e(){if(null!=h){var a=wpd.findElement("digitizedDataTable"),b=parseInt(wpd.findElement("data-number-format-digits").value,
10),c=wpd.findElement("data-number-format-style").value,d=wpd.findElement("data-number-format-separator").value,e,f,t,r=[],d=d.replace(/[^\\]\\t/,"\t").replace(/^\\t/,"\t");k="";for(e=0;e<h.length;e++){t=[];for(f=0;f<g.fields.length;f++)null!=g.fieldDateFormat[f]?(void 0===r[f]&&(r[f]=wpd.findElement("data-format-string-"+f).value),t[f]=wpd.dateConverter.formatDateNumber(h[e][f],r[f])):t[f]="string"===typeof h[e][f]?h[e][f]:"fixed"===c&&0<=b?h[e][f].toFixed(b):"precision"===c&&0<=b?h[e][f].toPrecision(b):
"exponential"===c&&0<=b?h[e][f].toExponential(b):h[e][f];k+=t.join(d);k+="\n"}a.value=k}}var f,g,h,k;return{showTable:function(){f=wpd.plotDataProvider;c()},showAngleData:function(){f=wpd.measurementDataProvider;f.setDataSource("angle");c()},showDistanceData:function(){f=wpd.measurementDataProvider;f.setDataSource("distance");c()},updateSortingControls:b,reSort:function(){b();d();e()},selectAll:function(){var a=wpd.findElement("digitizedDataTable");a.focus();a.select()},generateCSV:function(){var a=
f.getDatasetNames()[f.getDatasetIndex()];wpd.download.csv(JSON.stringify(k),a)},exportToPlotly:function(){if(null!=h){var a={data:[]},b,c,d;a.data[0]={};for(b=0;b<h.length;b++)for(c=0;c<g.fields.length;c++)d=g.fields[c],0===c?d="x":1===c&&(d="y"),0===b&&(a.data[0][d]=[]),a.data[0][d][b]=null!=g.fieldDateFormat[c]?wpd.dateConverter.formatDateNumber(h[b][c],"yyyy-mm-dd"):h[b][c];wpd.plotly.send(a)}},changeDataset:function(){var b=wpd.findElement("data-table-dataset-list");f.setDatasetIndex(b.selectedIndex);
a()}}}();wpd=wpd||{};
wpd.graphicsWidget=function(){function c(a){var b=B.getBoundingClientRect();return{x:parseInt(a.pageX-(b.left+window.pageXOffset),10),y:parseInt(a.pageY-(b.top+window.pageYOffset),10)}}function a(a,b){return{x:a/K,y:b/K}}function b(a,b){a=parseInt(a,10);b=parseInt(b,10);V.style.width=a+"px";V.style.height=b+"px";B.width=a;G.width=a;M.width=a;J.width=a;H.width=a;B.height=b;G.height=b;M.height=b;J.height=b;H.height=b;Y=a/(1*b);N=a;O=b;if(null!=Q){F.fillStyle="rgb(255, 255, 255)";F.fillRect(0,0,N,O);
F.drawImage(L,0,0,N,O);if(null!=C&&void 0!=C.onRedraw)C.onRedraw();if(null!=y&&void 0!=y.onRedraw)y.onRedraw()}}function d(){G.width=G.width;M.width=M.width;J.width=J.width;H.width=H.width;I.width=I.width}function e(){if(null!=C&&void 0!=C.onRemove)C.onRemove();C=null}function f(){var a=wpd.layoutManager.getGraphicsViewportSize();b(a.width,a.height);Y>S?(K=O/(1*D),b(O*S,O)):(K=N/(1*E),b(N,N/S))}function g(a){K=a;b(E*K,D*K)}function h(){T=!T;var a=wpd.findElement("extended-crosshair-btn");T?a.classList.add("pressed-button"):
a.classList.remove("pressed-button");J.width=J.width}function k(a,b){var c=wpd.zoomView.getSize(),d=wpd.zoomView.getZoomRatio(),e,f,g,h,k,m,l,n=0,p=0,q=c.width,r=c.height;g=c.width/d;h=c.height/d;e=a-g/2;f=b-h/2;m=e;c=f;k=e+g;l=f+h;0>e&&(m=0,n=-e*d);0>f&&(c=0,p=-f*d);e+g>=E&&(k=E,q-=d*(E-(e+g)));f+h>=D&&(l=D,r-=d*(D-(f+h)));g=R.getImageData(parseInt(m,10),parseInt(c,10),parseInt(k-m,10),parseInt(l-c,10));k=U.getImageData(parseInt(m,10),parseInt(c,10),parseInt(k-m,10),parseInt(l-c,10));for(e=0;e<k.data.length;e+=
4)if(0!=k.data[e]||0!=k.data[e+1]||0!=k.data[e+2])l=k.data[e+3]/255,g.data[e]=(1-l)*g.data[e]+l*k.data[e],g.data[e+1]=(1-l)*g.data[e+1]+l*k.data[e+1],g.data[e+2]=(1-l)*g.data[e+2]+l*k.data[e+2];m=d*(parseInt(m,10)-m);d*=parseInt(c,10)-c;wpd.zoomView.setZoomImage(g,parseInt(n+m,10),parseInt(p+d,10),parseInt(q-n,10),parseInt(r-p,10))}function m(b){clearTimeout(Z);var d=setTimeout,e=c(b);b=e.x;var e=e.y,f=a(b,e);T&&(J.width=J.width,P.strokeStyle="rgba(0,0,0, 0.5)",P.beginPath(),P.moveTo(b,0),P.lineTo(b,
O),P.moveTo(0,e),P.lineTo(N,e),P.stroke());k(f.x,f.y);wpd.zoomView.setCoords(f.x,f.y);Z=d(void 0,10)}function l(){B=wpd.findElement("mainCanvas");G=wpd.findElement("dataCanvas");M=wpd.findElement("drawCanvas");J=wpd.findElement("hoverCanvas");H=wpd.findElement("topCanvas");L=document.createElement("canvas");I=document.createElement("canvas");F=B.getContext("2d");W=G.getContext("2d");P=J.getContext("2d");aa=H.getContext("2d");ba=M.getContext("2d");R=L.getContext("2d");U=I.getContext("2d");V=wpd.findElement("canvasDiv");
y=null;document.addEventListener("keydown",function(a){X&&220===a.keyCode&&(a.preventDefault(),h())},!1);H.addEventListener("mousemove",m,!1);H.addEventListener("dragover",function(a){a.preventDefault()},!0);H.addEventListener("drop",function(a){a.preventDefault();wpd.busyNote.show();a=a.dataTransfer.files;1===a.length&&q(a[0])},!0);H.addEventListener("mousemove",r,!1);H.addEventListener("click",v,!1);H.addEventListener("mouseup",x,!1);H.addEventListener("mousedown",z,!1);H.addEventListener("mouseout",
A,!0);document.addEventListener("mouseup",w,!1);document.addEventListener("mousedown",function(a){X=a.target===H?!0:!1},!1);document.addEventListener("keydown",function(a){if(X&&null!=y&&void 0!=y.onKeyDown)y.onKeyDown(a)},!0);wpd.zoomView.initZoom();wpd.findElement("fileLoadBox").addEventListener("change",u);window.addEventListener("paste",function(a){if(void 0!==a.clipboardData&&(a=a.clipboardData.items,void 0!==a))for(var b=0;b<a.length;b++)if(-1!==a[b].type.indexOf("image")){wpd.busyNote.show();
var c=a[b].getAsFile();(window.URL||window.webkitURL).createObjectURL(c);q(c)}},!1)}function n(a,b){var c=document.createElement("img");c.onload=function(){(null==B||wpd.isWindowed)&&l();wpd.appData.reset();wpd.sidebar.clear();t();e();E=c.width;D=c.height;ca=c.src;S=E/(1*D);L.width=E;L.height=D;I.width=E;I.height=D;R.drawImage(c,0,0,E,D);Q=R.getImageData(0,0,E,D);B.width=B.width;d();f();wpd.appData.plotLoaded(Q);wpd.busyNote.close();b&&b.call()};c.src=a}function p(a,b,c,h,k){t();e();E=b;D=c;S=E/(1*
D);L.width=E;L.height=D;I.width=E;I.height=D;R.putImageData(a,0,0);Q=a;B.width=B.width;d();k?g(K):f();h&&(wpd.appData.reset(),wpd.appData.plotLoaded(Q))}function q(a){if(a.type.match("image.*")){var b=new FileReader;b.onload=function(){n(b.result)};b.readAsDataURL(a)}else wpd.messagePopup.show(wpd.gettext("invalid-file"),wpd.gettext("invalid-file-text")),wpd.busyNote.close()}function u(){var a=wpd.findElement("fileLoadBox");1==a.files.length&&(a=a.files[0],wpd.busyNote.show(),q(a));wpd.popup.close("loadNewImage")}
function t(){if(null!=y&&void 0!=y.onRemove)y.onRemove();y=null}function r(b){if(null!=y&&void 0!=y.onMouseMove){var d=c(b),e=a(d.x,d.y);y.onMouseMove(b,d,e)}}function v(b){if(null!=y&&void 0!=y.onMouseClick){var d=c(b),e=a(d.x,d.y);y.onMouseClick(b,d,e)}}function w(b){if(null!=y&&void 0!=y.onDocumentMouseUp){var d=c(b),e=a(d.x,d.y);y.onDocumentMouseUp(b,d,e)}}function x(b){if(null!=y&&void 0!=y.onMouseUp){var d=c(b),e=a(d.x,d.y);y.onMouseUp(b,d,e)}}function z(b){if(null!=y&&void 0!=y.onMouseDown){var d=
c(b),e=a(d.x,d.y);y.onMouseDown(b,d,e)}}function A(b){if(null!=y&&void 0!=y.onMouseOut){var d=c(b),e=a(d.x,d.y);y.onMouseOut(b,d,e)}}var B,G,M,J,H,L,I,V,F,W,ba,P,aa,R,U,N,O,E,D,ca,S,Y,Q,K,T=!1,Z,y,C,X=!1;return{zoomIn:function(){g(1.2*K)},zoomOut:function(){g(K/1.2)},zoomFit:f,zoom100perc:function(){g(1)},toggleExtendedCrosshairBtn:h,setZoomRatio:g,getZoomRatio:function(){return K},loadImageFromURL:n,loadImageFromData:p,load:u,runImageOp:function(a,b){var c=a(Q,E,D);p(c.imageData,c.width,c.height,
b,c.keepZoom)},setTool:function(a){if(null!=y&&void 0!=y.onRemove)y.onRemove();y=a;if(null!=y&&void 0!=y.onAttach)y.onAttach()},removeTool:t,getAllContexts:function(){return{mainCtx:F,dataCtx:W,drawCtx:ba,hoverCtx:P,topCtx:aa,oriImageCtx:R,oriDataCtx:U}},resetData:function(){I.width=I.width;G.width=G.width},resetHover:function(){J.width=J.width},imagePx:a,screenPx:function(a,b){return{x:a*K,y:b*K}},updateZoomOnEvent:function(b){b=c(b);b=a(b.x,b.y);k(b.x,b.y);wpd.zoomView.setCoords(b.x,b.y)},updateZoomToImagePosn:function(a,
b){k(a,b);wpd.zoomView.setCoords(a,b)},getDisplaySize:function(){return{width:N,height:O}},getImageSize:function(){return{width:E,height:D}},copyImageDataLayerToScreen:function(){W.drawImage(I,0,0,N,O)},setRepainter:function(a){if(null==C||void 0==C.painterName||null==a||void 0==a.painterName||C.painterName!=a.painterName){if(null!=C&&void 0!=C.onRemove)C.onRemove();C=a;if(null!=C&&void 0!=C.onAttach)C.onAttach()}},removeRepainter:e,forceHandlerRepaint:function(){if(null!=C&&void 0!=C.onForcedRedraw)C.onForcedRedraw()},
getRepainter:function(){return C},saveImage:function(){var a=document.createElement("canvas"),b=a.getContext("2d"),c,d,e,f;a.width=E;a.height=D;b.drawImage(L,0,0,E,D);c=b.getImageData(0,0,E,D);e=U.getImageData(0,0,E,D);for(d=0;d<c.data.length;d+=4)if(0!=e.data[d]||0!=e.data[d+1]||0!=e.data[d+2])f=e.data[d+3]/255,c.data[d]=(1-f)*c.data[d]+f*e.data[d],c.data[d+1]=(1-f)*c.data[d+1]+f*e.data[d+1],c.data[d+2]=(1-f)*c.data[d+2]+f*e.data[d+2];b.putImageData(c,0,0);window.open(a.toDataURL(),"_blank")},getImageSrc:function(){return ca}}}();
wpd=wpd||{};
wpd.layoutManager=function(){function c(){var a=wpd.isWindowed?wpd.parent_ref.width():parseInt(document.body.offsetWidth,10),b=wpd.isWindowed?wpd.parent_ref.height():parseInt(document.body.offsetHeight,10);e.style.height=b+"px";f.style.height=b-280+"px";g.style.width=a-e.offsetWidth-5+"px";g.style.height=b+"px";d.style.height=b-44+"px";wpd.sidebar.resize()}function a(a){clearTimeout(b);b=setTimeout(c,80)}var b,d,e,f,g;return{initialLayout:function(){d=wpd.findElement("graphicsContainer");e=wpd.findElement("sidebarContainer");
f=wpd.findElement("sidebarControlsContainer");g=wpd.findElement("mainContainer");c();window.addEventListener("resize",a,!1)},getGraphicsViewportSize:function(){return{width:d.offsetWidth,height:d.offsetHeight}}}}();wpd=wpd||{};
wpd.popup=function(){function c(c){var d=document.createElement("div");d.className="popup-drag-mask";d.style.display="inline-block";d.addEventListener("mousemove",a,!1);d.addEventListener("mouseup",b,!1);d.addEventListener("mouseout",e,!1);document.body.appendChild(d);g={dragMaskDiv:d,initialMouseX:c.pageX,initialMouseY:c.pageY,initialWindowX:h.offsetLeft,initialWindowY:h.offsetTop};c.preventDefault();c.stopPropagation()}function a(a){d(a);a.stopPropagation();a.preventDefault()}function b(a){d(a);
f();a.stopPropagation();a.preventDefault()}function d(a){var b=g.initialWindowX+a.pageX-g.initialMouseX;a=g.initialWindowY+a.pageY-g.initialMouseY;var c=parseInt(document.body.offsetWidth,10),d=parseInt(document.body.offsetHeight,10),e=parseInt(h.offsetWidth,10),f=parseInt(h.offsetHeight,10);b+.7*e<c&&0<b&&0<a&&a+.5*f<d&&(h.style.top=a+"px",h.style.left=b+"px")}function e(a){f()}function f(){null!=g&&null!=g.dragMaskDiv&&(g.dragMaskDiv.removeEventListener("mouseout",e,!1),g.dragMaskDiv.removeEventListener("mouseup",
b,!1),g.dragMaskDiv.removeEventListener("mousemove",a,!1),g.dragMaskDiv.style.display="none",document.body.removeChild(g.dragMaskDiv),g=null)}var g=null,h=null;return{show:function(a){wpd.findElement("shadow").style.visibility="visible";a=wpd.findElement(a);var b=wpd.isWindowed?wpd.parent_ref.width():parseInt(window.innerWidth,10),d=wpd.isWindowed?wpd.parent_ref.height():parseInt(window.innerHeight,10),e=parseInt(a.offsetWidth,10),f=parseInt(a.offsetHeight,10),d=(d-f)/2;a.style.left=(b-e)/2+"px";
a.style.top=(60<d?60:d)+"px";a.style.visibility="visible";for(b=0;b<a.childNodes.length;b++)if("popupheading"===a.childNodes[b].className){a.childNodes[b].addEventListener("mousedown",c,!1);break}h=a},close:function(a){wpd.findElement("shadow").style.visibility="hidden";wpd.findElement(a).style.visibility="hidden";f();h=null}}}();
wpd.busyNote=function(){var c,a=!1;return{show:function(){a||(null==c&&(c=document.createElement("div"),c.id="wait",c.innerHTML='<p align="center">'+wpd.gettext("processing")+"...</p>"),document.body.appendChild(c),a=!0)},close:function(){null!=c&&!0===a&&(document.body.removeChild(c),a=!1)}}}();
wpd.messagePopup=function(){var c;return{show:function(a,b,d){wpd.popup.show("messagePopup");wpd.findElement("message-popup-heading").innerHTML=a;wpd.findElement("message-popup-text").innerHTML=b;c=d},close:function(){wpd.popup.close("messagePopup");null!=c&&c()}}}();
wpd.okCancelPopup=function(){var c,a;return{show:function(b,d,e,f){wpd.popup.show("okCancelPopup");wpd.findElement("ok-cancel-popup-heading").innerHTML=b;wpd.findElement("ok-cancel-popup-text").innerHTML=d;c=e;a=f},ok:function(){wpd.popup.close("okCancelPopup");c()},cancel:function(){wpd.popup.close("okCancelPopup");a()}}}();wpd.unsupported=function(){wpd.messagePopup.show(wpd.gettext("unsupported"),wpd.gettext("unsupported-text"))};wpd=wpd||{};
wpd.sidebar=function(){function c(){var a=wpd.findElementsByClass("sidebar"),b;for(b=0;b<a.length;b++)a[b].style.display="none"}return{show:function(a){c();a=wpd.findElement(a);a.style.display="inline-block";a.style.height=wpd.isWindowed?wpd.parent_ref.height()-280+"px":parseInt(document.body.offsetHeight,10)-280+"px"},clear:c,resize:function(){var a=wpd.findElementsByClass("sidebar"),b;for(b=0;b<a.length;b++)"inline-block"===a[b].style.display&&(a[b].style.height=wpd.isWindowed?wpd.parent_ref.height()-
280+"px":parseInt(document.body.offsetHeight,10)-280+"px")}}}();wpd=wpd||{};wpd.toolbar=function(){function c(){var a=wpd.findElementsByClass("toolbar"),b;for(b=0;b<a.length;b++)a[b].style.visibility="hidden"}return{show:function(a){c();wpd.findElement(a).style.visibility="visible"},clear:c}}();wpd=wpd||{};
wpd.transformationEquations=function(){return{show:function(){if(!1===wpd.appData.isAligned())wpd.messagePopup.show(wpd.gettext("transformation-eqns"),wpd.gettext("transformation-eqns-text"));else{wpd.popup.show("axes-transformation-equations-window");var c=wpd.findElement("axes-transformation-equation-list"),a="",b=wpd.appData.getPlotData().axes,d=b.getTransformationEquations(),a=a+"<p><b>Axes Type</b>: ";b instanceof wpd.XYAxes?a+="XY</p>":b instanceof wpd.PolarAxes?a+="Polar</p>":b instanceof wpd.TernaryAxes?
a+="Ternary</p>":b instanceof wpd.MapAxes?a+="Map</p>":b instanceof wpd.ImageAxes&&(a+="Image</p>");if(null!=d.pixelToData){a+="<p><b>Pixel to Data</b></p><ol>";for(b=0;b<d.pixelToData.length;b++)a+='<li><p class="footnote">'+d.pixelToData[b]+"</p></li>";a+="</ol>"}a+="<p>&nbsp;</p>";if(null!=d.dataToPixel){a+="<p><b>Data to Pixel</b></p><ol>";for(b=0;b<d.dataToPixel.length;b++)a+='<li><p class="footnote">'+d.dataToPixel[b]+"</p></li>";a+="</ol>"}c.innerHTML=a}}}}();wpd=wpd||{};
wpd.webcamCapture=function(){function c(){void 0!=a&&a.stop();wpd.popup.close("webcamCapture")}var a;return{start:function(){if(null==(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia))wpd.messagePopup.show(wpd.gettext("webcam-capture"),wpd.gettext("webcam-capture-text"));else{wpd.popup.show("webcamCapture");var b=wpd.findElement("webcamVideo");navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||
navigator.msGetUserMedia;navigator.getUserMedia({video:!0},function(c){a=c;b.src=window.URL.createObjectURL(c)},function(){})}},cancel:function(){c()},capture:function(){var a=document.createElement("canvas"),d=wpd.findElement("webcamVideo"),e=a.getContext("2d"),f;a.width=d.videoWidth;a.height=d.videoHeight;e.drawImage(d,0,0);f=e.getImageData(0,0,a.width,a.height);c();wpd.graphicsWidget.runImageOp(function(){return{imageData:f,width:a.width,height:a.height}})}}}();wpd=wpd||{};
wpd.zoomView=function(){function c(){var a=wpd.findElement("zoomCrossHair"),b=a.getContext("2d");a.width=a.width;b.strokeStyle="black"===h?"rgba(0,0,0,1)":"red"===h?"rgba(255,0,0,1)":"yellow"===h?"rgba(255,255,0,1)":"rgba(0,0,0,1)";b.beginPath();b.moveTo(125,0);b.lineTo(125,250);b.moveTo(0,125);b.lineTo(250,125);b.stroke()}var a,b,d,e,f,g,h="black";return{initZoom:function(){a=wpd.findElement("zoomCanvas");b=a.getContext("2d");d=document.createElement("canvas");e=d.getContext("2d");f=wpd.findElement("mousePosition");
g=5;c()},setZoomImage:function(c,f,h,n,p){d.width=n/g;d.height=p/g;e.putImageData(c,0,0);a.width=a.width;b.drawImage(d,f,h,n,p)},setCoords:function(a,b){if(wpd.appData.isAligned()){var c=wpd.appData.getPlotData();f.innerHTML=c.axes.pixelToLiveString(a,b)}else f.innerHTML=a.toFixed(2)+", "+b.toFixed(2)},setZoomRatio:function(a){g=a},getZoomRatio:function(){return g},getSize:function(){return{width:250,height:250}},showSettingsWindow:function(){wpd.findElement("zoom-magnification-value").value=g;wpd.findElement("zoom-crosshair-color-value").value=
h;wpd.popup.show("zoom-settings-popup")},applySettings:function(){g=wpd.findElement("zoom-magnification-value").value;h=wpd.findElement("zoom-crosshair-color-value").value;c();wpd.popup.close("zoom-settings-popup")}}}();wpd=wpd||{};
wpd.xyCalibration=function(){function c(){wpd.popup.show("xyAlignment")}return{start:function(){wpd.popup.show("xyAxesInfo")},reload:function(){var a=new wpd.AxesCornersTool(4,2,["X1","X2","Y1","Y2"],!0);wpd.graphicsWidget.setTool(a)},pickCorners:function(){wpd.popup.close("xyAxesInfo");var a=new wpd.AxesCornersTool(4,2,["X1","X2","Y1","Y2"]);wpd.graphicsWidget.setTool(a)},getCornerValues:c,align:function(){var a=wpd.findElement("xmin").value,b=wpd.findElement("xmax").value,d=wpd.findElement("ymin").value,
e=wpd.findElement("ymax").value,f=wpd.findElement("xlog").checked,g=wpd.findElement("ylog").checked,h=new wpd.XYAxes,k=wpd.alignAxes.getActiveCalib();k.setDataAt(0,a,d);k.setDataAt(1,b,d);k.setDataAt(2,a,d);k.setDataAt(3,b,e);if(!h.calibrate(k,f,g))return wpd.popup.close("xyAlignment"),wpd.messagePopup.show(wpd.gettext("calibration-invalid-inputs"),wpd.gettext("calibration-enter-valid"),c),!1;a=wpd.appData.getPlotData();a.axes=h;a.calibration=k;wpd.popup.close("xyAlignment");return!0}}}();
wpd.barCalibration=function(){function c(){wpd.popup.show("barAlignment")}return{start:function(){wpd.popup.show("barAxesInfo")},reload:function(){var a=new wpd.AxesCornersTool(2,2,["P1","P2"],!0);wpd.graphicsWidget.setTool(a)},pickCorners:function(){wpd.popup.close("barAxesInfo");var a=new wpd.AxesCornersTool(2,2,["P1","P2"]);wpd.graphicsWidget.setTool(a)},getCornerValues:c,align:function(){var a=wpd.findElement("bar-axes-p1").value,b=wpd.findElement("bar-axes-p2").value,d=wpd.findElement("bar-axes-log-scale").checked,
e=new wpd.BarAxes,f=wpd.alignAxes.getActiveCalib();f.setDataAt(0,0,a);f.setDataAt(1,0,b);if(!e.calibrate(f,d))return wpd.popup.close("barAlignment"),wpd.messagePopup.show(wpd.gettext("calibration-invalid-inputs"),wpd.gettext("calibration-enter-valid"),c),!1;a=wpd.appData.getPlotData();a.axes=e;a.calibration=f;wpd.popup.close("barAlignment");return!0}}}();
wpd.polarCalibration=function(){return{start:function(){wpd.popup.show("polarAxesInfo")},reload:function(){var c=new wpd.AxesCornersTool(3,2,["Origin","P1","P2"],!0);wpd.graphicsWidget.setTool(c)},pickCorners:function(){wpd.popup.close("polarAxesInfo");var c=new wpd.AxesCornersTool(3,2,["Origin","P1","P2"]);wpd.graphicsWidget.setTool(c)},getCornerValues:function(){wpd.popup.show("polarAlignment")},align:function(){var c=parseFloat(wpd.findElement("polar-r1").value),a=parseFloat(wpd.findElement("polar-theta1").value),
b=parseFloat(wpd.findElement("polar-r2").value),d=parseFloat(wpd.findElement("polar-theta2").value),e=wpd.findElement("polar-degrees").checked;wpd.findElement("polar-radians");var f=wpd.findElement("polar-clockwise").checked,g=wpd.findElement("polar-log-scale").checked,h=new wpd.PolarAxes,k=wpd.alignAxes.getActiveCalib();k.setDataAt(1,c,a);k.setDataAt(2,b,d);h.calibrate(k,e,f,g);c=wpd.appData.getPlotData();c.axes=h;c.calibration=k;wpd.popup.close("polarAlignment");return!0}}}();
wpd.ternaryCalibration=function(){return{start:function(){wpd.popup.show("ternaryAxesInfo")},reload:function(){var c=new wpd.AxesCornersTool(3,3,["A","B","C"],!0);wpd.graphicsWidget.setTool(c)},pickCorners:function(){wpd.popup.close("ternaryAxesInfo");var c=new wpd.AxesCornersTool(3,3,["A","B","C"]);wpd.graphicsWidget.setTool(c)},getCornerValues:function(){wpd.popup.show("ternaryAlignment")},align:function(){wpd.findElement("range0to1");var c=wpd.findElement("range0to100").checked,a=wpd.findElement("ternarynormal").checked,
b=new wpd.TernaryAxes,d=wpd.alignAxes.getActiveCalib();b.calibrate(d,c,a);c=wpd.appData.getPlotData();c.axes=b;c.calibration=d;wpd.popup.close("ternaryAlignment");return!0}}}();
wpd.mapCalibration=function(){return{start:function(){wpd.popup.show("mapAxesInfo")},reload:function(){var c=new wpd.AxesCornersTool(2,2,["P1","P2"],!0);wpd.graphicsWidget.setTool(c)},pickCorners:function(){wpd.popup.close("mapAxesInfo");var c=new wpd.AxesCornersTool(2,2,["P1","P2"]);wpd.graphicsWidget.setTool(c)},getCornerValues:function(){wpd.popup.show("mapAlignment")},align:function(){var c=parseFloat(wpd.findElement("scaleLength").value),a=wpd.findElement("scaleUnits").value,b=new wpd.MapAxes,
d=wpd.alignAxes.getActiveCalib();b.calibrate(d,c,a);c=wpd.appData.getPlotData();c.axes=b;c.calibration=d;wpd.popup.close("mapAlignment");return!0}}}();
wpd.AxesCornersTool=function(){return function(c,a,b,d){var e=0,f=new wpd.Calibration(a),g=!0;d?(e=c,f=wpd.alignAxes.getActiveCalib(),g=!1):(e=0,f=new wpd.Calibration(a),g=!0,f.labels=b,wpd.alignAxes.setActiveCalib(f),wpd.graphicsWidget.resetData());this.onMouseClick=function(a,b,d){g?(e+=1,b=wpd.alignAxes.getActiveCalib(),b.addPoint(d.x,d.y,0,0),b.unselectAll(),b.selectPoint(e-1),wpd.graphicsWidget.forceHandlerRepaint(),e===c&&(g=!1,wpd.alignAxes.calibrationCompleted())):(b=wpd.alignAxes.getActiveCalib(),
b.unselectAll(),b.selectNearestPoint(d.x,d.y),wpd.graphicsWidget.forceHandlerRepaint());wpd.graphicsWidget.updateZoomOnEvent(a)};this.onKeyDown=function(a){var b=wpd.alignAxes.getActiveCalib();if(0!==b.getSelectedPoints().length){var c=b.getPoint(b.getSelectedPoints()[0]),d=c.px,c=c.py,e=!0===a.shiftKey?5/wpd.graphicsWidget.getZoomRatio():.5/wpd.graphicsWidget.getZoomRatio();if(wpd.keyCodes.isUp(a.keyCode))c-=e;else if(wpd.keyCodes.isDown(a.keyCode))c+=e;else if(wpd.keyCodes.isLeft(a.keyCode))d-=
e;else if(wpd.keyCodes.isRight(a.keyCode))d+=e;else return;b.changePointPx(b.getSelectedPoints()[0],d,c);wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomToImagePosn(d,c);a.preventDefault();a.stopPropagation()}}}}();
wpd.AlignmentCornersRepainter=function(){return function(){this.painterName="AlignmentCornersReptainer";this.onForcedRedraw=function(){wpd.graphicsWidget.resetData();this.onRedraw()};this.onRedraw=function(){var c=wpd.alignAxes.getActiveCalib();if(null!=c){var a,b,d;for(a=0;a<c.getCount();a++)b=c.getPoint(a),b={x:b.px,y:b.py},d=c.isPointSelected(a)?"rgba(0,200,0,1)":"rgba(200,0,0,1)",wpd.graphicsHelper.drawPoint(b,d,c.labels[a])}}}}();
wpd.alignAxes=function(){var c,a;return{start:function(){xyEl=wpd.findElement("r_xy");polarEl=wpd.findElement("r_polar");ternaryEl=wpd.findElement("r_ternary");mapEl=wpd.findElement("r_map");imageEl=wpd.findElement("r_image");barEl=wpd.findElement("r_bar");wpd.popup.close("axesList");if(!0===xyEl.checked)a=wpd.xyCalibration;else if(!0===barEl.checked)a=wpd.barCalibration;else if(!0===polarEl.checked)a=wpd.polarCalibration;else if(!0===ternaryEl.checked)a=wpd.ternaryCalibration;else if(!0===mapEl.checked)a=
wpd.mapCalibration;else if(!0===imageEl.checked){a=null;var b=new wpd.ImageAxes;b.calibrate();wpd.appData.getPlotData().axes=b;wpd.appData.isAligned(!0);wpd.acquireData.load()}null!=a&&(a.start(),wpd.graphicsWidget.setRepainter(new wpd.AlignmentCornersRepainter))},calibrationCompleted:function(){wpd.sidebar.show("axes-calibration-sidebar")},getCornerValues:function(){a.getCornerValues()},align:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.removeRepainter();wpd.graphicsWidget.resetData();
a.align()&&(wpd.appData.isAligned(!0),wpd.dataSeriesManagement.manage.call(wpd.dataSeriesManagement),wpd.acquireData.load())},getActiveCalib:function(){return c},setActiveCalib:function(a){c=a},editAlignment:function(){wpd.appData.isAligned()&&null!=a?wpd.popup.show("edit-or-reset-calibration-popup"):wpd.popup.show("axesList")},reloadCalibrationForEditing:function(){wpd.popup.close("edit-or-reset-calibration-popup");a.reload();wpd.graphicsWidget.setRepainter(new wpd.AlignmentCornersRepainter);wpd.graphicsWidget.forceHandlerRepaint();
wpd.sidebar.show("axes-calibration-sidebar")}}}();wpd=wpd||{};
wpd.autoExtraction=function(){function c(){var a=wpd.appData.getPlotData();a.getActiveDataSeries();var b=a.getActiveDataSeriesIndex(),c=wpd.findElement("automatic-sidebar-dataset-list"),e="",f;for(f=0;f<a.dataSeriesColl.length;f++)e+="<option>"+a.dataSeriesColl[f].name+"</option>";c.innerHTML=e;c.selectedIndex=b}return{start:function(){wpd.sidebar.show("auto-extraction-sidebar");c();wpd.colorPicker.init();wpd.algoManager.updateAlgoList()},updateDatasetControl:c,changeDataset:function(){var a=wpd.findElement("automatic-sidebar-dataset-list").selectedIndex;
wpd.appData.getPlotData().setActiveDataSeriesIndex(a);wpd.graphicsWidget.forceHandlerRepaint();wpd.dataPointCounter.setCount()}}}();
wpd.algoManager=function(){function c(){var a=wpd.findElement("auto-extract-algo-name").value,c=wpd.appData.getPlotData().getAutoDetector();c.algorithm="averagingWindow"===a?new wpd.AveragingWindowAlgo:"XStepWithInterpolation"===a?new wpd.XStepWithInterpolationAlgo:"XStep"===a?new wpd.AveragingWindowWithStepSizeAlgo:"blobDetector"===a?new wpd.BlobDetectorAlgo:"barExtraction"===a||"histogram"===a?new wpd.BarExtractionAlgo:new wpd.AveragingWindowAlgo;var c=c.algorithm,a=wpd.findElement("algo-parameter-container"),
c=c.getParamList(),e,f="<table>";for(e=0;e<c.length;e++)f+="<tr><td>"+c[e][0]+'</td><td><input type="text" size=3 id="algo-param-'+e+'" class="algo-params" value="'+c[e][2]+'"/></td><td>'+c[e][1]+"</td></tr>";a.innerHTML=f+"</table>"}var a;return{updateAlgoList:function(){var b="",d=wpd.appData.getPlotData().axes,e=wpd.findElement("auto-extract-algo-name");d!==a&&(a=d,d instanceof wpd.BarAxes||(b+='<option value="averagingWindow">'+wpd.gettext("averaging-window")+"</option>"),d instanceof wpd.XYAxes&&
!d.isLogX()&&!d.isLogY()&&(b+='<option value="XStepWithInterpolation">'+wpd.gettext("x-step-with-interpolation")+"</option>",b+='<option value="XStep">'+wpd.gettext("x-step")+"</option>"),d instanceof wpd.BarAxes||(b+='<option value="blobDetector">'+wpd.gettext("blob-detector")+"</option>"),d instanceof wpd.BarAxes&&(b+='<option value="barExtraction">'+wpd.gettext("bar-extraction")+"</option>"),d instanceof wpd.XYAxes&&(b+='<option value="histogram">'+wpd.gettext("histogram")+"</option>"),e.innerHTML=
b,c())},applyAlgoSelection:c,run:function(){wpd.busyNote.show();setTimeout(function(){var a=wpd.appData.getPlotData().getAutoDetector(),c=a.algorithm,e=new wpd.DataPointsRepainter,f=wpd.findElementsByClass("algo-params"),g,h,k=wpd.graphicsWidget.getAllContexts(),m=wpd.graphicsWidget.getImageSize();for(g=0;g<f.length;g++)h=f[g].id,h=parseInt(h.replace("algo-param-",""),10),c.setParam(h,parseFloat(f[g].value));wpd.graphicsWidget.removeTool();a.imageData=k.oriImageCtx.getImageData(0,0,m.width,m.height);
a.generateBinaryData();wpd.graphicsWidget.setRepainter(e);c.run(wpd.appData.getPlotData());wpd.graphicsWidget.forceHandlerRepaint();wpd.dataPointCounter.setCount();wpd.busyNote.close();return!0},10)}}}();wpd=wpd||{};
wpd.colorSelectionWidget=function(){function c(){wpd.findElement("color-selection-selected-color-box").style.backgroundColor="rgb("+a[0]+","+a[1]+","+a[2]+")";wpd.findElement("color-selection-red").value=a[0];wpd.findElement("color-selection-green").value=a[1];wpd.findElement("color-selection-blue").value=a[2];var b=wpd.findElement("color-selection-options"),c=wpd.appData.getPlotData().topColors,d=10<c.length?10:c.length,e,m="",l,n;for(e=0;e<d;e++)n="rgb("+c[e].r+","+c[e].g+","+c[e].b+");",l=c[e].percentage.toFixed(3)+
"%",m+='<div class="colorOptionBox" style="background-color: '+n+'" title="'+l+'" onclick="wpd.colorSelectionWidget.selectTopColor('+e+');"></div>';b.innerHTML=m;wpd.popup.show("color-selection-widget")}var a,b,d,e;return{setParams:function(c){a=c.color;b=c.triggerElementId;d=c.title;e=c.setColorDelegate;wpd.findElement("color-selection-title").innerHTML=d},startPicker:c,pickColor:function(){wpd.popup.close("color-selection-widget");var b=new wpd.ColorPickerTool;b.onComplete=function(b){a=b;e(b);
wpd.graphicsWidget.removeTool();c()};wpd.graphicsWidget.setTool(b)},setColor:function(){var c=[];c[0]=parseInt(wpd.findElement("color-selection-red").value,10);c[1]=parseInt(wpd.findElement("color-selection-green").value,10);c[2]=parseInt(wpd.findElement("color-selection-blue").value,10);a=c;e(c);wpd.popup.close("color-selection-widget");c=wpd.findElement(b);c.style.backgroundColor="rgb("+a[0]+","+a[1]+","+a[2]+")";c.style.color=200>a[0]+a[1]+a[2]?"rgb(255,255,255)":"rgb(0,0,0)"},selectTopColor:function(b){var d=
[],h=wpd.appData.getPlotData().topColors;d[0]=h[b].r;d[1]=h[b].g;d[2]=h[b].b;a=d;e(d);c()},paintFilteredColor:function(a,b){var c=wpd.graphicsWidget.getAllContexts();wpd.appData.getPlotData().getAutoDetector();var d=wpd.graphicsWidget.getImageSize(),e,l,n;n=c.oriDataCtx.getImageData(0,0,d.width,d.height);if(null!=b&&0!==b.length){for(e=0;e<b.length;e++)l=b[e],!0===a[l]?(parseInt(l/d.width,10),n.data[4*l]=255,n.data[4*l+1]=255,n.data[4*l+2]=0,n.data[4*l+3]=255):(n.data[4*l]=0,n.data[4*l+1]=0,n.data[4*
l+2]=0,n.data[4*l+3]=150);c.oriDataCtx.putImageData(n,0,0);wpd.graphicsWidget.copyImageDataLayerToScreen()}}}}();
wpd.colorPicker=function(){function c(){return{color:wpd.appData.getPlotData().getAutoDetector().fgColor,triggerElementId:"color-button",title:wpd.gettext("specify-foreground-color"),setColorDelegate:function(a){wpd.appData.getPlotData().getAutoDetector().fgColor=a}}}function a(){return{color:wpd.appData.getPlotData().getAutoDetector().bgColor,triggerElementId:"color-button",title:wpd.gettext("specify-background-color"),setColorDelegate:function(a){wpd.appData.getPlotData().getAutoDetector().bgColor=
a}}}function b(){var a=wpd.findElement("color-button"),b=wpd.findElement("color-distance-value"),c=wpd.appData.getPlotData().getAutoDetector(),g=wpd.findElement("color-detection-mode-select"),h;h="fg"===c.colorDetectionMode?c.fgColor:c.bgColor;color_distance=c.colorDistance;a.style.backgroundColor="rgb("+h[0]+","+h[1]+","+h[2]+")";b.value=color_distance;g.value=c.colorDetectionMode}return{startPicker:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.removeRepainter();wpd.graphicsWidget.resetData();
"fg"===wpd.appData.getPlotData().getAutoDetector().colorDetectionMode?wpd.colorSelectionWidget.setParams(c()):wpd.colorSelectionWidget.setParams(a());wpd.colorSelectionWidget.startPicker()},changeDetectionMode:function(){var a=wpd.findElement("color-detection-mode-select");wpd.appData.getPlotData().getAutoDetector().colorDetectionMode=a.value;b()},changeColorDistance:function(){var a=parseFloat(wpd.findElement("color-distance-value").value);wpd.appData.getPlotData().getAutoDetector().colorDistance=
a},init:b,testColorDetection:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();wpd.graphicsWidget.setRepainter(new wpd.ColorFilterRepainter);var a=wpd.graphicsWidget.getAllContexts(),b=wpd.appData.getPlotData().getAutoDetector(),c=wpd.graphicsWidget.getImageSize();b.imageData=a.oriImageCtx.getImageData(0,0,c.width,c.height);b.generateBinaryData();wpd.colorSelectionWidget.paintFilteredColor(b.binaryData,b.mask)}}}();
wpd.ColorPickerTool=function(){return function(){var c=wpd.graphicsWidget.getAllContexts();this.onMouseClick=function(a,b,d){var e;e=c.oriImageCtx.getImageData(d.x,d.y,1,1);a=e.data[0];b=e.data[1];d=e.data[2];0===e.data[3]&&(d=b=a=255);this.onComplete([a,b,d])};this.onComplete=function(a){}}}();
wpd.ColorFilterRepainter=function(){return function(){this.painterName="colorFilterRepainter";this.onRedraw=function(){var c=wpd.appData.getPlotData().getAutoDetector();wpd.colorSelectionWidget.paintFilteredColor(c.binaryData,c.mask)}}}();wpd=wpd||{};
wpd.plotDataProvider=function(){return{getDatasetNames:function(){var c=wpd.appData.getPlotData(),a=[],b;for(b=0;b<c.dataSeriesColl.length;b++)a[b]=c.dataSeriesColl[b].name;return a},getDatasetIndex:function(){return wpd.appData.getPlotData().getActiveDataSeriesIndex()},setDatasetIndex:function(c){wpd.appData.getPlotData().setActiveDataSeriesIndex(c);wpd.graphicsWidget.forceHandlerRepaint();wpd.dataPointCounter.setCount()},getData:function(){if(wpd.appData.getPlotData().axes instanceof wpd.BarAxes){var c=
[],a=[],b=[],b=wpd.appData.getPlotData(),c=b.getActiveDataSeries(),b=b.axes,d,e,f;for(d=0;d<c.getCount();d++)e=c.getPixel(d),f=b.pixelToData(e.x,e.y),a[d]=[],e=null==e.metadata?"Bar"+d:e.metadata[0],a[d][0]=e,a[d][1]=f[0];c=["Label","Value"];b=[!1,!0];return{fields:c,fieldDateFormat:[],rawData:a,allowConnectivity:!1,connectivityFieldIndices:[],isFieldSortable:b}}var c=wpd.appData.getPlotData(),a=c.getActiveDataSeries(),c=c.axes,g=[],b=[];d=[];f=[];e=[];for(var h,k,m,l=a.hasMetadata(),n=a.getMetadataKeys(),
p=!0===l?n.length:0,g=0;g<a.getCount();g++){k=a.getPixel(g);m=c.pixelToData(k.x,k.y);f[g]=[];for(h=0;h<m.length;h++)f[g][h]=m[h];void 0!==k.extraVars&&$.merge(f[g],k.extraVars);for(h=0;h<p;h++)m=null==k.metadata||null==k.metadata[h]?0:k.metadata[h],f[g].push(m)}g=a.variableNames;l&&(g=g.concat(n));for(h=0;h<g.length;h++)h<c.getDimensions()&&(d[h]=h,null!=c.isDate&&c.isDate(h)&&(b[h]=c.getInitialDateFormat(h))),e[h]=!0;return{fields:g,fieldDateFormat:b,rawData:f,allowConnectivity:!0,connectivityFieldIndices:d,
isFieldSortable:e}}}}();
wpd.measurementDataProvider=function(){var c="distance";return{getDatasetNames:function(){if("angle"===c)return["Angle Measurements"];if("distance"===c)return["Distance Measurements"]},getDatasetIndex:function(){return 0},setDatasetIndex:function(a){},setDataSource:function(a){c=a},getData:function(){var a=[],b=[],d=[],e=wpd.appData.getPlotData(),f=e.axes,g=wpd.appData.isAligned()&&f instanceof wpd.MapAxes;if("distance"===c){d=e.distanceMeasurementData;for(a=0;a<d.connectionCount();a++)b[a]=[],b[a][0]=
"Dist"+a,b[a][1]=g?f.pixelToDataDistance(d.getDistance(a)):d.getDistance(a);a=["Label","Distance"];d=[!1,!0]}else if("angle"===c){d=e.angleMeasurementData;for(a=0;a<d.connectionCount();a++)b[a]=[],b[a][0]="Theta"+a,b[a][1]=d.getAngle(a);a=["Label","Angle"];d=[!1,!0]}return{fields:a,fieldDateFormat:[],rawData:b,allowConnectivity:!1,connectivityFieldIndices:[],isFieldSortable:d}}}}();wpd=wpd||{};
wpd.graphicsHelper=function(){return{drawPoint:function(c,a,b){var d=wpd.graphicsWidget.screenPx(c.x,c.y),e=wpd.graphicsWidget.getAllContexts(),f;null!=b&&(e.dataCtx.font="15px sans-serif",f=e.dataCtx.measureText(b).width,e.dataCtx.fillStyle="rgba(255, 255, 255, 0.7)",e.dataCtx.fillRect(d.x-13,d.y-8,f+5,35),e.dataCtx.fillStyle=a,e.dataCtx.fillText(b,d.x-10,d.y+18));e.dataCtx.beginPath();e.dataCtx.fillStyle=a;e.dataCtx.strokeStyle="rgb(255, 255, 255)";e.dataCtx.arc(d.x,d.y,4,0,2*Math.PI,!0);e.dataCtx.fill();
e.dataCtx.stroke();null!=b&&(e.oriDataCtx.font="15px sans-serif",e.oriDataCtx.fillStyle=a,e.oriDataCtx.fillText(b,c.x-10,c.y+18));e.oriDataCtx.beginPath();e.oriDataCtx.fillStyle=a;e.oriDataCtx.strokeStyle="rgb(255, 255, 255)";e.oriDataCtx.arc(c.x,c.y,4,0,2*Math.PI,!0);e.oriDataCtx.fill();e.oriDataCtx.stroke()}}}();wpd=wpd||{};
wpd.gridDetection=function(){function c(a,b,c){var d=wpd.appData.getPlotData().backupImageData,k;for(k=0;k<d.data.length;k++)a.data[k]=d.data[k];return{imageData:a,width:b,height:c,keepZoom:!0}}function a(){wpd.graphicsWidget.removeTool();wpd.appData.getPlotData().gridData=null;wpd.graphicsWidget.removeRepainter();wpd.graphicsWidget.resetData();null!=wpd.appData.getPlotData().backupImageData&&wpd.graphicsWidget.runImageOp(c)}function b(a,b,c){var d=wpd.appData.getPlotData().gridData,k=wpd.appData.getPlotData().topColors[0],
m,l,n;null==k&&(k={r:255,g:0,b:0});if(null!=d)for(m=0;m<c;m++)for(l=0;l<b;l++)n=4*(m*b+l),!0===d[n/4]&&(a.data[n]=k.r,a.data[n+1]=k.g,a.data[n+2]=k.b,a.data[n+3]=255);return{imageData:a,width:b,height:c}}function d(){var a=parseFloat(wpd.findElement("grid-color-distance").value);wpd.appData.getPlotData().getAutoDetector().gridColorDistance=a}return{start:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.removeRepainter();wpd.graphicsWidget.resetData();wpd.sidebar.show("grid-detection-sidebar");
var a=wpd.findElement("grid-color-picker-button"),b=wpd.findElement("grid-background-mode"),c=wpd.appData.getPlotData().getAutoDetector(),d=c.gridLineColor,c=c.gridBackgroundMode;null!=d&&(a.style.backgroundColor="rgb("+d[0]+","+d[1]+","+d[2]+")",a.style.color=200>d[0]+d[1]+d[2]?"rgb(255,255,255)":"rgb(0,0,0)");b.checked=c;a=wpd.appData.getPlotData().getAutoDetector();b=wpd.graphicsWidget.getAllContexts();d=wpd.graphicsWidget.getImageSize();a.imageData=b.oriImageCtx.getImageData(0,0,d.width,d.height)},
markBox:function(){var a=new wpd.GridBoxTool;wpd.graphicsWidget.setTool(a)},clearMask:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.removeRepainter();wpd.appData.getPlotData().getAutoDetector().gridMask={xmin:null,xmax:null,ymin:null,ymax:null,pixels:[]};wpd.graphicsWidget.resetData()},viewMask:function(){var a=new wpd.GridViewMaskTool;wpd.graphicsWidget.setTool(a)},grabMask:function(){var a=wpd.graphicsWidget.getAllContexts(),b=wpd.graphicsWidget.getImageSize(),a=a.oriDataCtx.getImageData(0,
0,b.width,b.height),c=[],d,k=0,m=wpd.appData.getPlotData().getAutoDetector(),l,n;for(d=0;d<a.data.length;d+=4)255===a.data[d]&&255===a.data[d+1]&&0===a.data[d+2]&&(c[k]=d/4,k++,l=parseInt(d/4%b.width,10),n=parseInt(d/4/b.width,10),1===k?(m.gridMask.xmin=l,m.gridMask.xmax=l,m.gridMask.ymin=n,m.gridMask.ymax=n):(l<m.gridMask.xmin&&(m.gridMask.xmin=l),l>m.gridMask.xmax&&(m.gridMask.xmax=l),n<m.gridMask.ymin&&(m.gridMask.ymin=n),n>m.gridMask.ymax&&(m.gridMask.ymax=n)));m.gridMask.pixels=c},startColorPicker:function(){wpd.colorSelectionWidget.setParams({color:wpd.appData.getPlotData().getAutoDetector().gridLineColor,
triggerElementId:"grid-color-picker-button",title:"Specify Grid Line Color",setColorDelegate:function(a){wpd.appData.getPlotData().getAutoDetector().gridLineColor=a}});wpd.colorSelectionWidget.startPicker()},changeColorDistance:d,changeBackgroundMode:function(){var a=wpd.findElement("grid-background-mode").checked;wpd.appData.getPlotData().getAutoDetector().gridBackgroundMode=a},testColor:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();wpd.graphicsWidget.setRepainter(new wpd.GridColorFilterRepainter);
var a=wpd.appData.getPlotData().getAutoDetector();d();a.generateGridBinaryData();wpd.colorSelectionWidget.paintFilteredColor(a.gridBinaryData,a.gridMask.pixels)},run:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.removeRepainter();wpd.graphicsWidget.resetData();a();var c=wpd.appData.getPlotData().getAutoDetector(),d=wpd.graphicsWidget.getAllContexts(),g=wpd.graphicsWidget.getImageSize(),h=wpd.findElement("grid-horiz-perc"),k=wpd.findElement("grid-vert-perc"),m=wpd.findElement("grid-horiz-enable").checked,
l=wpd.findElement("grid-vert-enable").checked;wpd.findElement("grid-background-mode");var n=wpd.appData.getPlotData();null==n.backupImageData&&(n.backupImageData=d.oriImageCtx.getImageData(0,0,g.width,g.height));c.imageData=d.oriImageCtx.getImageData(0,0,g.width,g.height);c.generateGridBinaryData();wpd.gridDetectionCore.setHorizontalParameters(m,h.value);wpd.gridDetectionCore.setVerticalParameters(l,k.value);wpd.gridDetectionCore.run();wpd.graphicsWidget.runImageOp(b);wpd.appData.getPlotData().gridData=
null},reset:a}}();wpd.GridColorFilterRepainter=function(){return function(){this.painterName="gridColorFilterRepainter";this.onRedraw=function(){var c=wpd.appData.getPlotData().getAutoDetector();wpd.colorSelectionWidget.paintFilteredColor(c.gridBinaryData,c.gridMask.pixels)}}}();
wpd.GridBoxTool=function(){return function(){var c=!1,a,b,d=wpd.graphicsWidget.getAllContexts(),e,f,g=function(){wpd.graphicsWidget.resetHover();d.hoverCtx.strokeStyle="rgb(0,0,0)";d.hoverCtx.strokeRect(b.x,b.y,f.x-b.x,f.y-b.y)},h=function(f,g,h){!1!==c&&(clearTimeout(e),c=!1,wpd.graphicsWidget.resetHover(),d.dataCtx.fillStyle="rgba(255,255,0,0.8)",d.dataCtx.fillRect(b.x,b.y,g.x-b.x,g.y-b.y),d.oriDataCtx.fillStyle="rgba(255,255,0,0.8)",d.oriDataCtx.fillRect(a.x,a.y,h.x-a.x,h.y-a.y))},k=null,m=null;
this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.GridMaskPainter);wpd.findElement("grid-mask-box").classList.add("pressed-button");wpd.findElement("grid-mask-view").classList.add("pressed-button")};this.onMouseDown=function(d,e,f){!0!==c&&(c=!0,a=f,b=e)};this.onMouseMove=function(a,b,d){!1!==c&&(f=b,clearTimeout(e),e=setTimeout(g,2))};this.onMouseOut=function(a,b,d){!0===c&&(clearTimeout(e),k=b,m=d)};this.onDocumentMouseUp=function(a,b,c){null!=k&&null!=m?h(a,k,m):h(a,b,c);m=k=null};
this.onMouseUp=function(a,b,c){h(a,b,c)};this.onRemove=function(){wpd.findElement("grid-mask-box").classList.remove("pressed-button");wpd.findElement("grid-mask-view").classList.remove("pressed-button");wpd.gridDetection.grabMask()}}}();
wpd.GridViewMaskTool=function(){return function(){this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.GridMaskPainter);wpd.findElement("grid-mask-view").classList.add("pressed-button")};this.onRemove=function(){wpd.findElement("grid-mask-view").classList.remove("pressed-button");wpd.gridDetection.grabMask()}}}();
wpd.GridMaskPainter=function(){return function(){var c=wpd.graphicsWidget.getAllContexts(),a=wpd.appData.getPlotData().getAutoDetector(),b=function(){if(null!=a.gridMask.pixels&&0!==a.gridMask.pixels.length){var b,e;b=wpd.graphicsWidget.getImageSize();imgData=c.oriDataCtx.getImageData(0,0,b.width,b.height);for(b=0;b<a.gridMask.pixels.length;b++)e=a.gridMask.pixels[b],imgData.data[4*e]=255,imgData.data[4*e+1]=255,imgData.data[4*e+2]=0,imgData.data[4*e+3]=200;c.oriDataCtx.putImageData(imgData,0,0);
wpd.graphicsWidget.copyImageDataLayerToScreen()}};this.painterName="gridMaskPainter";this.onRedraw=function(){wpd.gridDetection.grabMask();b()};this.onAttach=function(){wpd.graphicsWidget.resetData();b()}}}();wpd=wpd||{};wpd.DataChangeEvent=new Event("dataChange");
wpd.iframe_api=function(){return{setParentMsgFunction:function(c){this.parentMsgFunction=c},receiveMessage:function(c){c=JSON.parse(c);switch(c.name){case "loadImage":var a=null==c.graph_json?null:JSON.parse(c.graph_json);wpd.saveResume.importImageAndJSON(c.src,a);break;default:alert("Error: iFrame API call not recognized")}},sendMessage:function(c){""!=document.referrer&&this.parentMsgFunction(c,document.referrer)},sendDataChangeUpdate:function(){var c={name:"exportJSON",data:wpd.saveResume.generateJSON()};
wpd.iframe_api.sendMessage(c)}}}();wpd=wpd||{};
wpd.imageOps=function(){function c(a,c,e){var f,g,h,k,m,l;for(f=0;f<e;f++)for(g=0;g<c/2;g++)for(h=4*(f*c+g),k=4*((f+1)*c-(g+1)),l=0;4>l;l++)m=a.data[h+l],a.data[h+l]=a.data[k+l],a.data[k+l]=m;return{imageData:a,width:c,height:e}}function a(a,c,e){var f,g,h,k,m,l;for(f=0;f<e/2;f++)for(g=0;g<c;g++)for(h=4*(f*c+g),k=4*((e-(f+2))*c+g),l=0;4>l;l++)m=a.data[h+l],a.data[h+l]=a.data[k+l],a.data[k+l]=m;return{imageData:a,width:c,height:e}}return{hflip:function(){wpd.graphicsWidget.runImageOp(c)},vflip:function(){wpd.graphicsWidget.runImageOp(a)},
imageExists:function(a,c){var e=new XMLHttpRequest;e.open("HEAD",a,!1);e.send();return 404!=e.status}}}();wpd=wpd||{};
wpd.keyCodes=function(){return{isUp:function(c){return 38===c},isDown:function(c){return 40===c},isLeft:function(c){return 37===c},isRight:function(c){return 39===c},isTab:function(c){return 9===c},isDel:function(c){return 46===c},isBackspace:function(c){return 8===c},isAlphabet:function(c,a){return 90<c||65>c?!1:String.fromCharCode(c).toLowerCase()===a},isEnter:function(c){return 13===c},isEsc:function(c){return 27===c}}}();wpd=wpd||{};
wpd.acquireData=function(){function c(){var a=new wpd.ManualSelectionTool;wpd.graphicsWidget.setTool(a)}function a(){var a=new wpd.DeleteDataPointTool;wpd.graphicsWidget.setTool(a)}function b(){wpd.appData.getPlotData().getActiveDataSeries().clearAll();wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();wpd.dataPointCounter.setCount();wpd.graphicsWidget.removeRepainter()}function d(){wpd.sidebar.show("acquireDataSidebar");e();var a=wpd.appData.getPlotData().axes;wpd.findElement("edit-data-labels").style.display=
a instanceof wpd.BarAxes?"inline-block":"none";wpd.dataPointCounter.setCount()}function e(){var a=wpd.appData.getPlotData();a.getActiveDataSeries();var b=a.getActiveDataSeriesIndex(),c=wpd.findElement("manual-sidebar-dataset-list"),d="",e;for(e=0;e<a.dataSeriesColl.length;e++)d+="<option>"+a.dataSeriesColl[e].name+"</option>";c.innerHTML=d;c.selectedIndex=b}function f(){wpd.graphicsWidget.setTool(new wpd.AdjustDataPointTool)}function g(){wpd.graphicsWidget.setTool(new wpd.EditLabelsTool)}return{load:function(){wpd.appData.isAligned()?
(d(),wpd.dataPointCounter.setCount(),wpd.graphicsWidget.removeTool(),wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter),c()):wpd.messagePopup.show(wpd.gettext("acquire-data"),wpd.gettext("acquire-data-calibration"))},manualSelection:c,adjustPoints:f,deletePoint:a,clearAll:function(){0>=wpd.appData.getPlotData().getActiveDataSeries().getCount()||wpd.okCancelPopup.show(wpd.gettext("clear-data-points"),wpd.gettext("clear-data-points-text"),b,function(){})},confirmedClearAll:b,undo:function(){wpd.appData.getPlotData().getActiveDataSeries().removeLastPixel();
wpd.graphicsWidget.resetData();wpd.graphicsWidget.forceHandlerRepaint();wpd.dataPointCounter.setCount()},showSidebar:d,switchToolOnKeyPress:function(b){switch(b){case "d":a();break;case "a":c();break;case "s":f();break;case "e":g()}},isToolSwitchKey:function(a){return wpd.keyCodes.isAlphabet(a,"a")||wpd.keyCodes.isAlphabet(a,"s")||wpd.keyCodes.isAlphabet(a,"d")||wpd.keyCodes.isAlphabet(a,"e")?!0:!1},updateDatasetControl:e,changeDataset:function(a){a=a.selectedIndex;wpd.appData.getPlotData().setActiveDataSeriesIndex(a);
wpd.graphicsWidget.forceHandlerRepaint();wpd.dataPointCounter.setCount()},editLabels:g}}();
wpd.dataPointLabelEditor=function(){function c(){var a=wpd.findElement("data-point-label-field").value;null!=a&&0<a.length&&(b.setMetadataAt(d,[a]),wpd.graphicsWidget.resetData(),wpd.graphicsWidget.forceHandlerRepaint());wpd.popup.close("data-point-label-editor");wpd.graphicsWidget.setTool(e)}function a(){wpd.popup.close("data-point-label-editor");wpd.graphicsWidget.setTool(e)}var b,d,e;return{show:function(a,c,h){var k=a.getPixel(c).metadata[0];b=a;d=c;e=h;wpd.graphicsWidget.removeTool();wpd.popup.show("data-point-label-editor");
a=wpd.findElement("data-point-label-field");a.value=k;a.focus()},ok:c,cancel:a,keydown:function(b){wpd.keyCodes.isEnter(b.keyCode)?c():wpd.keyCodes.isEsc(b.keyCode)&&a();b.stopPropagation()}}}();
wpd.ManualSelectionTool=function(){return function(){var c=wpd.appData.getPlotData();this.onAttach=function(){wpd.findElement("manual-select-button").classList.add("pressed-button");wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter)};this.onMouseClick=function(a,b,d){b=c.getActiveDataSeries();var e;c.axes.dataPointsHaveLabels?(e=b.getMetadataKeys(),null!=e&&"Label"===e[0]||b.setMetadataKeys(["Label"]),e=c.axes.dataPointsLabelPrefix+b.getCount(),b.addPixel(d.x,d.y,[e]),wpd.graphicsHelper.drawPoint(d,
"rgb(200,0,0)",e)):(b.addPixel(d.x,d.y,null),wpd.graphicsHelper.drawPoint(d,"rgb(200,0,0)"));wpd.graphicsWidget.updateZoomOnEvent(a);wpd.dataPointCounter.setCount();c.axes.dataPointsHaveLabels&&a.shiftKey&&wpd.dataPointLabelEditor.show(b,b.getCount()-1,this)};this.onRemove=function(){wpd.findElement("manual-select-button").classList.remove("pressed-button")};this.onKeyDown=function(a){var b=c.getActiveDataSeries(),d=b.getCount()-1,e=b.getPixel(d),f=.5/wpd.graphicsWidget.getZoomRatio();if(wpd.keyCodes.isUp(a.keyCode))e.y-=
f;else if(wpd.keyCodes.isDown(a.keyCode))e.y+=f;else if(wpd.keyCodes.isLeft(a.keyCode))e.x-=f;else if(wpd.keyCodes.isRight(a.keyCode))e.x+=f;else{wpd.acquireData.isToolSwitchKey(a.keyCode)&&wpd.acquireData.switchToolOnKeyPress(String.fromCharCode(a.keyCode).toLowerCase());return}b.setPixelAt(d,e.x,e.y);wpd.graphicsWidget.resetData();wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomToImagePosn(e.x,e.y);a.preventDefault()}}}();
wpd.DeleteDataPointTool=function(){return function(){wpd.graphicsWidget.getAllContexts();var c=wpd.appData.getPlotData();this.onAttach=function(){wpd.findElement("delete-point-button").classList.add("pressed-button");wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter)};this.onMouseClick=function(a,b,d){c.getActiveDataSeries().removeNearestPixel(d.x,d.y);wpd.graphicsWidget.resetData();wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomOnEvent(a);wpd.dataPointCounter.setCount()};
this.onKeyDown=function(a){wpd.acquireData.isToolSwitchKey(a.keyCode)&&wpd.acquireData.switchToolOnKeyPress(String.fromCharCode(a.keyCode).toLowerCase())};this.onRemove=function(){wpd.findElement("delete-point-button").classList.remove("pressed-button")}}}();
wpd.DataPointsRepainter=function(){return function(){var c=function(){var a=wpd.appData.getPlotData(),b=a.getActiveDataSeries(),c,e,f;c=b.getMetadataKeys();var g=!1,h;a.axes.dataPointsHaveLabels&&null!=c&&"Label"===c[0]&&(g=!0);for(c=0;c<b.getCount();c++)e=b.getPixel(c),f=(f=0<=b.getSelectedPixels().indexOf(c))?"rgb(0,200,0)":"rgb(200,0,0)",g?(h=e.metadata[0],null==h&&(h=a.axes.dataPointsLabelPrefix+c),wpd.graphicsHelper.drawPoint(e,f,h)):wpd.graphicsHelper.drawPoint(e,f)};this.painterName="dataPointsRepainter";
this.onAttach=function(){wpd.graphicsWidget.resetData();c()};this.onRedraw=function(){c()};this.onForcedRedraw=function(){wpd.graphicsWidget.resetData();c()}}}();
wpd.AdjustDataPointTool=function(){return function(){this.onAttach=function(){wpd.findElement("manual-adjust-button").classList.add("pressed-button");wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter);wpd.toolbar.show("adjustDataPointsToolbar")};this.onRemove=function(){wpd.appData.getPlotData().getActiveDataSeries().unselectAll();wpd.graphicsWidget.forceHandlerRepaint();wpd.findElement("manual-adjust-button").classList.remove("pressed-button");wpd.toolbar.clear()};this.onMouseClick=function(c,
a,b){a=wpd.appData.getPlotData().getActiveDataSeries();a.unselectAll();a.selectNearestPixel(b.x,b.y);wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomOnEvent(c)};this.onKeyDown=function(c){if(wpd.acquireData.isToolSwitchKey(c.keyCode))wpd.acquireData.switchToolOnKeyPress(String.fromCharCode(c.keyCode).toLowerCase());else{var a=wpd.appData.getPlotData().getActiveDataSeries(),b=a.getSelectedPixels()[0];if(null!=b){var d=a.getPixel(b),e=d.x,d=d.y,f=!0===c.shiftKey?5/wpd.graphicsWidget.getZoomRatio():
.5/wpd.graphicsWidget.getZoomRatio();if(wpd.keyCodes.isUp(c.keyCode))d-=f;else if(wpd.keyCodes.isDown(c.keyCode))d+=f;else if(wpd.keyCodes.isLeft(c.keyCode))e-=f;else if(wpd.keyCodes.isRight(c.keyCode))e+=f;else if(wpd.keyCodes.isAlphabet(c.keyCode,"q"))a.selectPreviousPixel(),b=a.getSelectedPixels()[0],d=a.getPixel(b),e=d.x,d=d.y;else if(wpd.keyCodes.isAlphabet(c.keyCode,"w"))a.selectNextPixel(),b=a.getSelectedPixels()[0],d=a.getPixel(b),e=d.x,d=d.y;else if(wpd.keyCodes.isAlphabet(c.keyCode,"e")){if(wpd.appData.getPlotData().axes.dataPointsHaveLabels){b=
a.getSelectedPixels()[0];c.preventDefault();c.stopPropagation();wpd.dataPointLabelEditor.show(a,b,this);return}}else{if(wpd.keyCodes.isDel(c.keyCode)||wpd.keyCodes.isBackspace(c.keyCode))a.removePixelAtIndex(b),a.unselectAll(),0<=a.findNearestPixel(e,d)&&(a.selectNearestPixel(e,d),b=a.getSelectedPixels()[0],d=a.getPixel(b),e=d.x,d=d.y),wpd.graphicsWidget.resetData(),wpd.graphicsWidget.forceHandlerRepaint(),wpd.graphicsWidget.updateZoomToImagePosn(e,d),wpd.dataPointCounter.setCount(),c.preventDefault(),
c.stopPropagation();return}a.setPixelAt(b,e,d);wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomToImagePosn(e,d);c.preventDefault();c.stopPropagation()}}}}}();
wpd.EditLabelsTool=function(){this.onAttach=function(){wpd.findElement("edit-data-labels").classList.add("pressed-button");wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter)};this.onRemove=function(){wpd.findElement("edit-data-labels").classList.remove("pressed-button");wpd.appData.getPlotData().getActiveDataSeries().unselectAll()};this.onMouseClick=function(c,a,b){a=wpd.appData.getPlotData().getActiveDataSeries();a.unselectAll();b=a.selectNearestPixel(b.x,b.y);0<=b&&(wpd.graphicsWidget.forceHandlerRepaint(),
wpd.graphicsWidget.updateZoomOnEvent(c),wpd.dataPointLabelEditor.show(a,b,this))};this.onKeyDown=function(c){wpd.acquireData.isToolSwitchKey(c.keyCode)&&wpd.acquireData.switchToolOnKeyPress(String.fromCharCode(c.keyCode).toLowerCase())}};wpd.dataPointCounter=function(){return{setCount:function(){var c=wpd.findElementsByClass("data-point-counter"),a;for(a=0;a<c.length;a++)c[a].innerHTML=wpd.appData.getPlotData().getActiveDataSeries().getCount()}}}();wpd=wpd||{};
wpd.dataMask=function(){function c(){var a=wpd.graphicsWidget.getAllContexts(),b=wpd.graphicsWidget.getImageSize(),a=a.oriDataCtx.getImageData(0,0,b.width,b.height),b=[],c,e=0,f=wpd.appData.getPlotData().getAutoDetector();for(c=0;c<a.data.length;c+=4)255===a.data[c]&&255===a.data[c+1]&&0===a.data[c+2]&&(b[e]=c/4,e++);f.mask=b}return{grabMask:c,markBox:function(){var a=new wpd.BoxMaskTool;wpd.graphicsWidget.setTool(a)},markPen:function(){var a=new wpd.PenMaskTool;wpd.graphicsWidget.setTool(a)},eraseMarks:function(){var a=
new wpd.EraseMaskTool;wpd.graphicsWidget.setTool(a)},viewMask:function(){var a=new wpd.ViewMaskTool;wpd.graphicsWidget.setTool(a)},clearMask:function(){wpd.graphicsWidget.resetData();c()}}}();
wpd.BoxMaskTool=function(){return function(){var c=!1,a,b,d=wpd.graphicsWidget.getAllContexts(),e,f,g=function(){wpd.graphicsWidget.resetHover();d.hoverCtx.strokeStyle="rgb(0,0,0)";d.hoverCtx.strokeRect(b.x,b.y,f.x-b.x,f.y-b.y)},h=function(f,g,h){!1!==c&&(clearTimeout(e),c=!1,wpd.graphicsWidget.resetHover(),d.dataCtx.fillStyle="rgba(255,255,0,1)",d.dataCtx.fillRect(b.x,b.y,g.x-b.x,g.y-b.y),d.oriDataCtx.fillStyle="rgba(255,255,0,1)",d.oriDataCtx.fillRect(a.x,a.y,h.x-a.x,h.y-a.y))},k=null,m=null;this.onAttach=
function(){wpd.graphicsWidget.setRepainter(new wpd.MaskPainter);wpd.findElement("box-mask").classList.add("pressed-button");wpd.findElement("view-mask").classList.add("pressed-button")};this.onMouseDown=function(d,e,f){!0!==c&&(c=!0,a=f,b=e)};this.onMouseMove=function(a,b,d){!1!==c&&(f=b,clearTimeout(e),e=setTimeout(g,2))};this.onMouseOut=function(a,b,d){!0===c&&(clearTimeout(e),k=b,m=d)};this.onDocumentMouseUp=function(a,c,b){null!=k&&null!=m?h(a,k,m):h(a,c,b);m=k=null};this.onMouseUp=function(a,
c,b){h(a,c,b)};this.onRemove=function(){wpd.findElement("box-mask").classList.remove("pressed-button");wpd.findElement("view-mask").classList.remove("pressed-button");wpd.dataMask.grabMask()}}}();
wpd.PenMaskTool=function(){return function(){var c=wpd.graphicsWidget.getAllContexts(),a=!1,b,d,e,f=function(){c.dataCtx.strokeStyle="rgba(255,255,0,1)";c.dataCtx.lineTo(d.x,d.y);c.dataCtx.stroke();c.oriDataCtx.strokeStyle="rgba(255,255,0,1)";c.oriDataCtx.lineTo(e.x,e.y);c.oriDataCtx.stroke()};this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MaskPainter);wpd.findElement("pen-mask").classList.add("pressed-button");wpd.findElement("view-mask").classList.add("pressed-button");wpd.toolbar.show("paintToolbar")};
this.onMouseDown=function(b,d,e){!0!==a&&(b=parseInt(wpd.findElement("paintThickness").value,10),a=!0,c.dataCtx.strokeStyle="rgba(255,255,0,1)",c.dataCtx.lineWidth=b*wpd.graphicsWidget.getZoomRatio(),c.dataCtx.beginPath(),c.dataCtx.moveTo(d.x,d.y),c.oriDataCtx.strokeStyle="rgba(255,255,0,1)",c.oriDataCtx.lineWidth=b,c.oriDataCtx.beginPath(),c.oriDataCtx.moveTo(e.x,e.y))};this.onMouseMove=function(c,h,k){!1!==a&&(d=h,e=k,clearTimeout(b),b=setTimeout(f,2))};this.onMouseUp=function(d,e,f){clearTimeout(b);
c.dataCtx.closePath();c.dataCtx.lineWidth=1;c.oriDataCtx.closePath();c.oriDataCtx.lineWidth=1;a=!1};this.onMouseOut=function(a,c,b){this.onMouseUp(a,c,b)};this.onRemove=function(){wpd.findElement("pen-mask").classList.remove("pressed-button");wpd.findElement("view-mask").classList.remove("pressed-button");wpd.dataMask.grabMask();wpd.toolbar.clear()}}}();
wpd.EraseMaskTool=function(){return function(){var c=wpd.graphicsWidget.getAllContexts(),a=!1,b,d,e,f=function(){c.dataCtx.globalCompositeOperation="destination-out";c.oriDataCtx.globalCompositeOperation="destination-out";c.dataCtx.strokeStyle="rgba(255,255,0,1)";c.dataCtx.lineTo(d.x,d.y);c.dataCtx.stroke();c.oriDataCtx.strokeStyle="rgba(255,255,0,1)";c.oriDataCtx.lineTo(e.x,e.y);c.oriDataCtx.stroke()};this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MaskPainter);wpd.findElement("erase-mask").classList.add("pressed-button");
wpd.findElement("view-mask").classList.add("pressed-button");wpd.toolbar.show("eraseToolbar")};this.onMouseDown=function(b,d,e){!0!==a&&(b=parseInt(wpd.findElement("eraseThickness").value,10),a=!0,c.dataCtx.globalCompositeOperation="destination-out",c.oriDataCtx.globalCompositeOperation="destination-out",c.dataCtx.strokeStyle="rgba(0,0,0,1)",c.dataCtx.lineWidth=b*wpd.graphicsWidget.getZoomRatio(),c.dataCtx.beginPath(),c.dataCtx.moveTo(d.x,d.y),c.oriDataCtx.strokeStyle="rgba(0,0,0,1)",c.oriDataCtx.lineWidth=
b,c.oriDataCtx.beginPath(),c.oriDataCtx.moveTo(e.x,e.y))};this.onMouseMove=function(c,h,k){!1!==a&&(d=h,e=k,clearTimeout(b),b=setTimeout(f,2))};this.onMouseOut=function(a,b,c){this.onMouseUp(a,b,c)};this.onMouseUp=function(d,e,f){clearTimeout(b);c.dataCtx.closePath();c.dataCtx.lineWidth=1;c.oriDataCtx.closePath();c.oriDataCtx.lineWidth=1;c.dataCtx.globalCompositeOperation="source-over";c.oriDataCtx.globalCompositeOperation="source-over";a=!1};this.onRemove=function(){wpd.findElement("erase-mask").classList.remove("pressed-button");
wpd.findElement("view-mask").classList.remove("pressed-button");wpd.dataMask.grabMask();wpd.toolbar.clear()}}}();wpd.ViewMaskTool=function(){return function(){this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MaskPainter);wpd.findElement("view-mask").classList.add("pressed-button")};this.onRemove=function(){wpd.findElement("view-mask").classList.remove("pressed-button");wpd.dataMask.grabMask()}}}();
wpd.MaskPainter=function(){return function(){var c=wpd.graphicsWidget.getAllContexts(),a=wpd.appData.getPlotData().getAutoDetector(),b=function(){if(null!=a.mask&&0!==a.mask.length){var b,e;b=wpd.graphicsWidget.getImageSize();imgData=c.oriDataCtx.getImageData(0,0,b.width,b.height);for(b=0;b<a.mask.length;b++)e=a.mask[b],imgData.data[4*e]=255,imgData.data[4*e+1]=255,imgData.data[4*e+2]=0,imgData.data[4*e+3]=255;c.oriDataCtx.putImageData(imgData,0,0);wpd.graphicsWidget.copyImageDataLayerToScreen()}};
this.painterName="dataMaskPainter";this.onRedraw=function(){wpd.dataMask.grabMask();b()};this.onAttach=function(){wpd.graphicsWidget.resetData();b()}}}();wpd=wpd||{};
wpd.measurementModes={distance:{name:"distance",connectivity:2,addButtonId:"add-pair-button",deleteButtonId:"delete-pair-button",sidebarId:"measure-distances-sidebar",init:function(){var c=wpd.appData.getPlotData();null==c.distanceMeasurementData&&(c.distanceMeasurementData=new wpd.ConnectedPoints(2))},clear:function(){wpd.appData.getPlotData().distanceMeasurementData=new wpd.ConnectedPoints(2)},getData:function(){return wpd.appData.getPlotData().distanceMeasurementData}},angle:{name:"angle",connectivity:3,
addButtonId:"add-angle-button",deleteButtonId:"delete-angle-button",sidebarId:"measure-angles-sidebar",init:function(){var c=wpd.appData.getPlotData();null==c.angleMeasurementData&&(c.angleMeasurementData=new wpd.ConnectedPoints(3))},clear:function(){wpd.appData.getPlotData().angleMeasurementData=new wpd.ConnectedPoints(3)},getData:function(){return wpd.appData.getPlotData().angleMeasurementData}},openPath:{name:"open-path",connectivity:-1,addButtonId:"add-open-path-button",deleteButtonId:"delete-open-path-button",
sidebarId:"measure-open-path-sidebar",init:function(){var c=wpd.appData.getPlotData();null==c.openPathMeasurementData&&(c.openPathMeasurementData=new wpd.ConnectedPoints)},clear:function(){wpd.appData.getPlotData().openPathMeasurementData=new wpd.ConnectedPoints},getData:function(){return wpd.appData.getPlotData().openPathMeasurementData}},closedPath:{name:"closed-path",connectivity:-1,addButtonId:"add-closed-path-button",deleteButtonId:"delete-closed-path-button",sidebarId:"measure-closed-path-sidebar",
init:function(){var c=wpd.appData.getPlotData();null==c.closedPathMeasurementData&&(c.closedPathMeasurementData=new wpd.ConnectedPoints)},clear:function(){wpd.appData.getPlotData().closedPathMeasurementData=new wpd.ConnectedPoints},getData:function(){return wpd.appData.getPlotData().closedPathMeasurementData}}};
wpd.measurement=function(){var c;return{start:function(a){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();a.init();wpd.sidebar.show(a.sidebarId);wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool(a));wpd.graphicsWidget.forceHandlerRepaint();c=a},addItem:function(){wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool(c))},deleteItem:function(){wpd.graphicsWidget.setTool(new wpd.DeleteMeasurementTool(c))},clearAll:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();
c.clear()}}}();
wpd.AddMeasurementTool=function(){return function(c){var a=wpd.graphicsWidget.getAllContexts(),b=0,d=!0,e=[];this.onAttach=function(){wpd.findElement(c.addButtonId).classList.add("pressed-button");wpd.graphicsWidget.setRepainter(new wpd.MeasurementRepainter(c))};this.onRemove=function(){wpd.findElement(c.addButtonId).classList.remove("pressed-button")};this.onKeyDown=function(a){wpd.keyCodes.isAlphabet(a.keyCode,"a")?(wpd.graphicsWidget.resetHover(),wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool(c))):wpd.keyCodes.isAlphabet(a.keyCode,
"d")?(wpd.graphicsWidget.resetHover(),wpd.graphicsWidget.setTool(new wpd.DeleteMeasurementTool(c))):(wpd.keyCodes.isEnter(a.keyCode)||wpd.keyCodes.isEsc(a.keyCode))&&!0===d&&0>c.connectivity&&(d=!1,c.getData().addConnection(e),wpd.graphicsWidget.forceHandlerRepaint(),wpd.graphicsWidget.setTool(new wpd.AdjustMeasurementTool(c)))};this.onMouseClick=function(f,g,h){if(d){wpd.graphicsWidget.resetHover();e[2*b]=h.x;e[2*b+1]=h.y;b+=1;if(b===c.connectivity){d=!1;c.getData().addConnection(e);wpd.graphicsWidget.forceHandlerRepaint();
wpd.graphicsWidget.setTool(new wpd.AdjustMeasurementTool(c));return}if(1<b){var k=wpd.graphicsWidget.screenPx(e[2*(b-2)],e[2*(b-2)+1]);a.dataCtx.beginPath();a.dataCtx.strokeStyle="rgb(0,0,10)";a.dataCtx.moveTo(k.x,k.y);a.dataCtx.lineTo(g.x,g.y);a.dataCtx.stroke();a.oriDataCtx.beginPath();a.oriDataCtx.strokeStyle="rgb(0,0,10)";a.oriDataCtx.moveTo(e[2*(b-2)],e[2*(b-2)+1]);a.oriDataCtx.lineTo(h.x,h.y);a.oriDataCtx.stroke()}a.dataCtx.beginPath();a.dataCtx.fillStyle="rgb(200, 0, 0)";a.dataCtx.arc(g.x,
g.y,3,0,2*Math.PI,!0);a.dataCtx.fill();a.oriDataCtx.beginPath();a.oriDataCtx.fillStyle="rgb(200,0,0)";a.oriDataCtx.arc(h.x,h.y,3,0,2*Math.PI,!0);a.oriDataCtx.fill()}wpd.graphicsWidget.updateZoomOnEvent(f)};this.onMouseMove=function(c,g,h){d&&1<=b&&(wpd.graphicsWidget.resetHover(),c=wpd.graphicsWidget.screenPx(e[2*(b-1)],e[2*(b-1)+1]),a.hoverCtx.beginPath(),a.hoverCtx.strokeStyle="rgb(0,0,0)",a.hoverCtx.moveTo(c.x,c.y),a.hoverCtx.lineTo(g.x,g.y),a.hoverCtx.stroke())}}}();
wpd.DeleteMeasurementTool=function(){return function(c){wpd.graphicsWidget.getAllContexts();wpd.appData.getPlotData();this.onAttach=function(){wpd.findElement(c.deleteButtonId).classList.add("pressed-button");wpd.graphicsWidget.setRepainter(new wpd.MeasurementRepainter(c))};this.onRemove=function(){wpd.findElement(c.deleteButtonId).classList.remove("pressed-button")};this.onKeyDown=function(a){wpd.keyCodes.isAlphabet(a.keyCode,"a")?wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool(c)):wpd.keyCodes.isAlphabet(a.keyCode,
"d")&&wpd.graphicsWidget.setTool(new wpd.DeleteMeasurementTool(c))};this.onMouseClick=function(a,b,d){c.getData().deleteNearestConnection(d.x,d.y);wpd.graphicsWidget.setTool(new wpd.AdjustMeasurementTool(c));wpd.graphicsWidget.resetData();wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomOnEvent(a)}}}();
wpd.AdjustMeasurementTool=function(){return function(c){this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MeasurementRepainter(c))};this.onMouseClick=function(a,b,d){c.getData().selectNearestPoint(d.x,d.y);wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomOnEvent(a)};this.onKeyDown=function(a){if(wpd.keyCodes.isAlphabet(a.keyCode,"a"))wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool(c));else if(wpd.keyCodes.isAlphabet(a.keyCode,"d"))wpd.graphicsWidget.setTool(new wpd.DeleteMeasurementTool(c));
else{var b=c.getData(),d=b.getSelectedConnectionAndPoint();if(0<=d.connectionIndex&&0<=d.pointIndex){var e=!0===a.shiftKey?5/wpd.graphicsWidget.getZoomRatio():.5/wpd.graphicsWidget.getZoomRatio(),f=b.getPointAt(d.connectionIndex,d.pointIndex);if(wpd.keyCodes.isUp(a.keyCode))f.y-=e;else if(wpd.keyCodes.isDown(a.keyCode))f.y+=e;else if(wpd.keyCodes.isLeft(a.keyCode))f.x-=e;else if(wpd.keyCodes.isRight(a.keyCode))f.x+=e;else return;b.setPointAt(d.connectionIndex,d.pointIndex,f.x,f.y);wpd.graphicsWidget.forceHandlerRepaint();
wpd.graphicsWidget.updateZoomToImagePosn(f.x,f.y);a.preventDefault();a.stopPropagation()}}}}}();
wpd.MeasurementRepainter=function(){return function(c){var a=wpd.graphicsWidget.getAllContexts(),b=function(b,c,d,e,m,l,n,p){a.dataCtx.beginPath();a.dataCtx.strokeStyle="rgb(0,0,10)";a.dataCtx.moveTo(b,c);a.dataCtx.lineTo(d,e);a.dataCtx.stroke();a.oriDataCtx.beginPath();a.oriDataCtx.strokeStyle="rgb(0,0,10)";a.oriDataCtx.moveTo(m,l);a.oriDataCtx.lineTo(n,p);a.oriDataCtx.stroke()},d=function(b,c,d,e,m){a.dataCtx.beginPath();a.dataCtx.fillStyle=m?"rgb(0, 200, 0)":"rgb(200, 0, 0)";a.dataCtx.arc(b,c,
3,0,2*Math.PI,!0);a.dataCtx.fill();a.oriDataCtx.beginPath();a.oriDataCtx.fillStyle=m?"rgb(0,200,0)":"rgb(200,0,0)";a.oriDataCtx.arc(d,e,3,0,2*Math.PI,!0);a.oriDataCtx.fill()},e=function(b,c,d,e,m){var l;b=parseInt(b,10);c=parseInt(c,10);d=parseInt(d,10);e=parseInt(e,10);a.dataCtx.font="14px sans-serif";l=a.dataCtx.measureText(m).width;a.dataCtx.fillStyle="rgba(255, 255, 255, 0.7)";a.dataCtx.fillRect(b-5,c-15,l+10,25);a.dataCtx.fillStyle="rgb(200, 0, 0)";a.dataCtx.fillText(m,b,c);a.oriDataCtx.font=
"14px sans-serif";l=a.oriDataCtx.measureText(m).width;a.oriDataCtx.fillStyle="rgba(255, 255, 255, 0.7)";a.oriDataCtx.fillRect(d-5,e-15,l+10,25);a.oriDataCtx.fillStyle="rgb(200, 0, 0)";a.oriDataCtx.fillText(m,d,e)};this.painterName="measurementRepainter-"+c.name;this.onAttach=function(){wpd.graphicsWidget.resetData()};this.onRedraw=function(){if(c.name===wpd.measurementModes.distance.name){var f=wpd.appData.getPlotData().distanceMeasurementData,g=f.connectionCount(),h,k,m,l,n,p,q,u,t,r,v=wpd.appData.getPlotData().axes;
for(h=0;h<g;h++)k=f.getConnectionAt(h),m=k[0],l=k[1],n=k[2],k=k[3],t=f.isPointSelected(h,0),r=f.isPointSelected(h,1),u=!0===wpd.appData.isAligned()&&v instanceof wpd.MapAxes?"Dist"+h.toString()+": "+v.pixelToDataDistance(f.getDistance(h)).toFixed(2)+" "+v.getUnits():"Dist"+h.toString()+": "+f.getDistance(h).toFixed(2)+" px",p=wpd.graphicsWidget.screenPx(m,l),q=wpd.graphicsWidget.screenPx(n,k),b(p.x,p.y,q.x,q.y,m,l,n,k),d(p.x,p.y,m,l,t),d(q.x,q.y,n,k,r),e(.5*(p.x+q.x),.5*(p.y+q.y),.5*(m+n),.5*(l+k),
u)}else if(c.name===wpd.measurementModes.angle.name){var f=wpd.appData.getPlotData().angleMeasurementData,g=f.connectionCount(),w,x,z,A,B;for(h=0;h<g;h++)n=f.getConnectionAt(h),q=n[0],u=n[1],m=n[2],l=n[3],t=n[4],r=n[5],z=f.isPointSelected(h,0),A=f.isPointSelected(h,1),B=f.isPointSelected(h,2),v="Theta"+h.toString()+": "+f.getAngle(h).toFixed(2)+"\u00b0",p=Math.atan2(u-l,q-m),k=Math.atan2(r-l,t-m),w=wpd.graphicsWidget.screenPx(q,u),n=wpd.graphicsWidget.screenPx(m,l),x=wpd.graphicsWidget.screenPx(t,
r),b(w.x,w.y,n.x,n.y,q,u,m,l),b(n.x,n.y,x.x,x.y,m,l,t,r),d(w.x,w.y,q,u,z),d(n.x,n.y,m,l,A),d(x.x,x.y,t,r,B),q=n.x,u=n.y,t=m,r=l,a.dataCtx.beginPath(),a.dataCtx.strokeStyle="rgb(0,0,10)",a.dataCtx.arc(q,u,15,p,k,!0),a.dataCtx.stroke(),a.oriDataCtx.beginPath(),a.oriDataCtx.strokeStyle="rgb(0,0,10)",a.oriDataCtx.arc(t,r,15,p,k,!0),a.oriDataCtx.stroke(),e(n.x+10,n.y+15,m+10,l+15,v)}};this.onForcedRedraw=function(){wpd.graphicsWidget.resetData();this.onRedraw()}}}();wpd=wpd||{};
wpd.perspective=function(){return{start:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.removeRepainter();wpd.graphicsWidget.resetData();wpd.popup.show("perspective-info")},pickCorners:function(){},run:function(){},revert:function(){}}}();wpd.perspectiveCornersRepainter=function(){this.painterName="perspectiveCornersRepainter";this.onRedraw=function(){}};wpd.perspectiveCornersTool=function(){this.onAttach=function(){};this.onMouseDown=function(){};this.onRemove=function(){}};
wpd=wpd||{};wpd.ajax=function(){return{get:function(c,a){if(null!=a){var b=new XMLHttpRequest;b.onload=function(c){200===this.status&&a(b)};b.open("GET",c,!0);b.send()}},post:function(c,a,b){if(null!=b){var d=new XMLHttpRequest;d.onload=function(a){200===this.status&&b(d)};d.open("POST",c,!0);d.setRequestHeader("Content-type","application/json");d.send(a)}}}}();wpd=wpd||{};
wpd.args=function(){return{getValue:function(c){var a,b,d=window.location.search.substring(1).split("&");for(a=0;a<d.length;a++)if(b=d[a].split("="),b[0]===c)return unescape(b[1]);return null}}}();wpd=wpd||{};
wpd.download=function(){function c(a,b,c){var e,f,g,h;e=document.createElement("div");f=document.createElement("form");g=document.createElement("textarea");h=document.createElement("input");h.type="hidden";f.setAttribute("method","post");"json"===c?f.setAttribute("action","php/json.php"):"csv"===c&&f.setAttribute("action","php/csvexport.php");g.setAttribute("name","data");g.setAttribute("id","data");h.setAttribute("name","filename");h.setAttribute("id","filename");h.value=b.replace(/[^a-zA-Z\d+\.\-_\s]/g,
"_");f.appendChild(g);f.appendChild(h);e.appendChild(f);document.body.appendChild(e);e.style.display="none";g.innerHTML=a;f.submit();document.body.removeChild(e)}return{json:function(a,b){null==b&&(b="wpd_plot_data");c(a,b,"json")},csv:function(a,b){null==b&&(b="data");c(a,b,"csv")}}}();wpd=wpd||{};wpd.gettext=function(c){return(c=wpd.findElement("i18n-string-"+c))?c.innerHTML:"i18n string"};wpd=wpd||{};
wpd.plotly=function(){return{send:function(c){var a=document.createElement("div"),b=document.createElement("form"),d=document.createElement("textarea");b.setAttribute("method","post");b.setAttribute("action","https://plot.ly/external");b.setAttribute("target","_blank");d.setAttribute("name","data");d.setAttribute("id","data");b.appendChild(d);a.appendChild(b);document.body.appendChild(a);a.style.display="none";c=JSON.stringify(c);d.innerHTML=c;b.submit();document.body.removeChild(a)}}}();
wpd=wpd||{};
wpd.saveResume=function(){function c(a){var b=wpd.appData.getPlotData();a=a.wpd;var c,g,h,k;b.reset();wpd.appData.isAligned(!1);if(null!=a.axesType&&("ImageAxes"===a.axesType||null!=a.calibration&&null!=a.axesParameters)){if("ImageAxes"!==a.axesType){c="TernaryAxes"===a.axesType?new wpd.Calibration(3):new wpd.Calibration(2);for(g=0;g<a.calibration.length;g++)c.addPoint(a.calibration[g].px,a.calibration[g].py,a.calibration[g].dx,a.calibration[g].dy,a.calibration[g].dz);b.calibration=c}if("XYAxes"===a.axesType){if(b.axes=
new wpd.XYAxes,!b.axes.calibrate(b.calibration,a.axesParameters.isLogX,a.axesParameters.isLogY))return}else if("BarAxes"===a.axesType){if(b.axes=new wpd.BarAxes,!b.axes.calibrate(b.calibration,a.axesParameters.isLog))return}else if("PolarAxes"===a.axesType){if(b.axes=new wpd.PolarAxes,!b.axes.calibrate(b.calibration,a.axesParameters.isDegrees,a.axesParameters.isClockwise))return}else if("TernaryAxes"===a.axesType){if(b.axes=new wpd.TernaryAxes,!b.axes.calibrate(b.calibration,a.axesParameters.isRange100,
a.axesParameters.isNormalOrientation))return}else if("MapAxes"===a.axesType){if(b.axes=new wpd.MapAxes,!b.axes.calibrate(b.calibration,a.axesParameters.scaleLength,a.axesParameters.unitString))return}else"ImageAxes"===a.axesType&&(b.axes=new wpd.ImageAxes);wpd.appData.isAligned(!0);if(null!=a.dataSeries){for(g=0;g<a.dataSeries.length;g++)for(h=a.dataSeries[g],b.dataSeriesColl[g]=new wpd.DataSeries,k=b.dataSeriesColl[g],k.name=h.name,k.variableIds=h.variableIds,k.variableNames=h.variableNames,null!=
h.metadataKeys&&k.setMetadataKeys(h.metadataKeys),c=0;c<h.data.length;c++)k.addPixel(h.data[c].x,h.data[c].y,h.data[c].metadata,h.data[c].extraVars);if(null!=a.distanceMeasurementData)for(b.distanceMeasurementData=new wpd.ConnectedPoints(2),g=0;g<a.distanceMeasurementData.length;g++)b.distanceMeasurementData.addConnection(a.distanceMeasurementData[g]);if(null!=a.angleMeasurementData)for(b.angleMeasurementData=new wpd.ConnectedPoints(3),g=0;g<a.angleMeasurementData.length;g++)b.angleMeasurementData.addConnection(a.angleMeasurementData[g]);
wpd.dataSeriesManagement.populate()}}}function a(){var a=wpd.appData.getPlotData(),b=a.calibration,c={wpd:{version:[3,8],imgSrc:wpd.graphicsWidget.getImageSrc(),axesType:null,axesParameters:null,calibration:null,dataSeries:[],distanceMeasurementData:null,angleMeasurementData:null}},g="",h,k;if(null!=b)for(c.wpd.calibration=[],g=0;g<b.getCount();g++)c.wpd.calibration[g]=b.getPoint(g);null!=a.axes&&(a.axes instanceof wpd.XYAxes?(c.wpd.axesType="XYAxes",c.wpd.axesParameters={isLogX:a.axes.isLogX(),isLogY:a.axes.isLogY()}):
a.axes instanceof wpd.BarAxes?(c.wpd.axesType="BarAxes",c.wpd.axesParameters={isLog:a.axes.isLog()}):a.axes instanceof wpd.PolarAxes?(c.wpd.axesType="PolarAxes",c.wpd.axesParameters={isDegrees:a.axes.isThetaDegrees(),isClockwise:a.axes.isThetaClockwise()}):a.axes instanceof wpd.TernaryAxes?(c.wpd.axesType="TernaryAxes",c.wpd.axesParameters={isRange100:a.axes.isRange100(),isNormalOrientation:a.axes.isNormalOrientation()}):a.axes instanceof wpd.MapAxes?(c.wpd.axesType="MapAxes",c.wpd.axesParameters=
{scaleLength:a.axes.getScaleLength(),unitString:a.axes.getUnits()}):a.axes instanceof wpd.ImageAxes&&(c.wpd.axesType="ImageAxes"));for(g=0;g<a.dataSeriesColl.length;g++)for(b=a.dataSeriesColl[g],c.wpd.dataSeries[g]={name:b.name,variableNames:b.variableNames,variableIds:b.variableIds,data:[]},h=b.getMetadataKeys(),null!=h&&(c.wpd.dataSeries[g].metadataKeys=h),h=0;h<b.getCount();h++){k=b.getPixel(h);c.wpd.dataSeries[g].data[h]=k;var m=a.axes.pixelToData(k.x,k.y);k.extraVars&&$.merge(m,k.extraVars);
c.wpd.dataSeries[g].data[h].value=m}if(null!=a.distanceMeasurementData)for(c.wpd.distanceMeasurementData=[],g=0;g<a.distanceMeasurementData.connectionCount();g++)c.wpd.distanceMeasurementData[g]=a.distanceMeasurementData.getConnectionAt(g);if(null!=a.angleMeasurementData)for(c.wpd.angleMeasurementData=[],g=0;g<a.angleMeasurementData.connectionCount();g++)c.wpd.angleMeasurementData[g]=a.angleMeasurementData.getConnectionAt(g);return g=JSON.stringify(c)}function b(a){c(a);wpd.graphicsWidget.resetData();
wpd.graphicsWidget.removeTool();wpd.graphicsWidget.removeRepainter();wpd.appData.isAligned()&&wpd.acquireData.load();wpd.messagePopup.show(wpd.gettext("import-json"),wpd.gettext("json-data-loaded"))}return{save:function(){wpd.popup.show("export-json-window")},load:function(){wpd.popup.show("import-json-window")},download:function(){wpd.download.json(a());wpd.popup.close("export-json-window")},generateJSON:a,importJSON:b,importImageAndJSON:function(a,b){wpd.graphicsWidget.loadImageFromURL(a,function(){null!=
b?wpd.saveResume.importJSON(b):wpd.popup.show("axesList")})},read:function(){var a=wpd.findElement("import-json-file");wpd.popup.close("import-json-window");if(1===a.files.length){var c=new FileReader;c.onload=function(){var a=JSON.parse(c.result);b(a)};c.readAsText(a.files[0])}}}}();wpd=wpd||{};
wpd.scriptInjector=function(){return{start:function(){wpd.popup.show("runScriptPopup")},cancel:function(){wpd.popup.close("runScriptPopup")},load:function(){var c=wpd.findElement("runScriptFileInput");wpd.popup.close("runScriptPopup");if(1==c.files.length){var a=new FileReader;a.onload=function(){"undefined"!==typeof wpdscript&&delete wpdscript;eval(a.result);"wpdscript"!==typeof wpdscript&&(window.wpdscript=wpdscript,wpdscript.run())};a.readAsText(c.files[0])}}}}();wpd=wpd||{};
wpd.websocket=function(){function c(){e=!0}function a(){e=!1;f={}}function b(a){if(null!=a.data)if(console.log(a.data),a=JSON.parse(a.data),null!=a){var b=f[a.timestamp];null!=b&&b.requestId===a.id&&(b.callback(a.message),delete f[a.timestamp])}else alert("Server announcement: "+a),console.log(a)}var d,e,f={};return{connect:function(e){d=new WebSocket(e);d.onopen=c;d.onmessage=b;d.onclose=a},registerRequest:function(a,b){},registerNotification:function(a,b){},request:function(a,b,c){var m=Date.now();
b=JSON.stringify({type:"request",timestamp:m,id:a,message:b});f[m]={requestId:a,callback:c};e&&(console.log(b),d.send(b))},notify:function(a,b){var c=Date.now(),c=JSON.stringify({type:"notification",timestamp:c,id:a,message:b});e&&(console.log(c),d.send(c))}}}();wpd=wpd||{};wpd.browserInfo=function(){return{checkBrowser:function(){window.FileReader||alert("\tWARNING!\nYour web browser is not supported. This program might not behave as intended. Please use a recent version of Google Chrome, Firefox or Safari browser.")}}}();
